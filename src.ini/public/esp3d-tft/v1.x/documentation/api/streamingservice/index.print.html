<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.126.3">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Streaming desctiption and API">
    <meta name="author" content="Luc LEBOSSE">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="GCode streaming API :: ESP3D Ecosystem">
    <meta name="twitter:description" content="Streaming desctiption and API">
    <meta property="og:url" content="http://localhost:1313/esp3d-tft/v1.x/documentation/api/streamingservice/index.html">
    <meta property="og:site_name" content="ESP3D Ecosystem">
    <meta property="og:title" content="GCode streaming API :: ESP3D Ecosystem">
    <meta property="og:description" content="Streaming desctiption and API">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="ESP3D-TFT">
    <meta itemprop="name" content="GCode streaming API :: ESP3D Ecosystem">
    <meta itemprop="description" content="Streaming desctiption and API">
    <meta itemprop="wordCount" content="1492">
    <title>GCode streaming API :: ESP3D Ecosystem</title>
    <link href="http://localhost:1313/esp3d-tft/v1.x/documentation/api/streamingservice/index.html" rel="canonical" type="text/html" title="GCode streaming API :: ESP3D Ecosystem">
    <link href="/esp3d-tft/v1.x/documentation/api/streamingservice/index.xml" rel="alternate" type="application/rss+xml" title="GCode streaming API :: ESP3D Ecosystem">
    <link href="/images/favicon.ico?1722688342" rel="icon" type="image/x-icon" sizes="any">
    <link href="/css/fontawesome-all.min.css?1722688348" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1722688348" rel="stylesheet"></noscript>
    <link href="/css/nucleus.css?1722688348" rel="stylesheet">
    <link href="/css/auto-complete.css?1722688348" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1722688348" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1722688348" rel="stylesheet">
    <link href="/css/fonts.css?1722688348" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1722688348" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1722688348" rel="stylesheet">
    <link href="/css/theme-blue.css?1722688348" rel="stylesheet" id="R-variant-style">
    <link href="/css/chroma-learn.css?1722688348" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/css/variant.css?1722688348" rel="stylesheet">
    <link href="/css/print.css?1722688348" rel="stylesheet" media="print">
    <link href="/css/format-print.css?1722688348" rel="stylesheet">
    <script src="/js/variant.js?1722688348"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.index_js_url="/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'blue' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support print" data-url="/esp3d-tft/v1.x/documentation/api/streamingservice/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">ESP3D Ecosystem</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/index.html"><span itemprop="name">ESP3D-TFT</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/v1.x/index.html"><span itemprop="name">Version 1.X</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/v1.x/documentation/index.html"><span itemprop="name">Documentation</span></a><meta itemprop="position" content="4">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/v1.x/documentation/api/index.html"><span itemprop="name">API</span></a><meta itemprop="position" content="5">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">GCode streaming API</span><meta itemprop="position" content="6"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/esp3d-tft/v1.x/documentation/api/conventions/index.html" title="Syntax conventions (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/esp3d-tft/v1.x/documentation/api/webdavservice/index.html" title="WebDAV API (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
<h1 id="gcode-streaming-api">GCode streaming API</h1>
<h2 id="clients">Clients</h2>
<p>The Gcode Stream Client is the actual streaming service, it is the only one that send msg to output client. On another way the GcodeStreamClient is only one of the active clients which will get the msg from the output client.
The GcodeStreamClient use the GCodeParser to parse in/out commands and handle messages correctly.</p>
<h2 id="components">Components</h2>
<p>1 - Streaming Types
There are several types of streaming services:<br>
A - Unknown<br>
The type is not yet defined, this type cannot be streamed until it is identified.</p>
<pre><code>B - Single Command
This is for any normal GCODE or ESPXXX command coming from any client, this type cannot be interrupted once started, ESP700 / ESP701 do not support it. This type will be added to the script queue and processed FIFO. 

C - Multiple Commands
This is used by scripts stored in EEPROM (resume/pause/abort), this type cannot be interrupted, and all commands will be executed one after another until the end, ESP700 / ESP701 do not support it. This type will be added to the script queue and processed FIFO

D - Flash File Stream
This is the one that will be used to stream a file from flash, this type can be interrupted only between each command execution.
This type will put in hold if any command is present in scripts queue and resumed when the scripts queue is empty.
This type is used with the command [ESP700]stream=/fs/mystream.gco
the file name must have the /fs/ prefix to be sure that the file is handled properly, the [ESP701] commands can handle it but only between commands commands execution, that the purpose of the stream= tag. This type will be added to the stream queue and processed FIFO.

E - Flash File script
This is the one that will be used to stream a file from flash, unlike previous type this type cannot be interrupted and will be excuted until the end. This one is used with the command [ESP700]/fs/myfile.gco
The file name must have the /fs/ prefix to be sure that the file is handled properly. The [ESP701] command do not handle it. The file should only contain few commands and it is used by macros only
This type will be added to the script queue and processed FIFO


F - SD File Stream
This is the one that will be used to stream a file from sd card, this type can be interrupted only between each command execution.
This type will put in hold if any command is present in scripts queue and resumed when the scripts queue is empty.
This type is used with the command [ESP700]stream=/sd/mystream.gco
the file name must have the /sd/ prefix to be sure that the file is handled properly, the [ESP701] commands can handle it but only between commands commands execution, that the purpose of the stream= tag. This type will be added to the stream queue and processed FIFO.

G - SD File script
This is the one that will be used to stream a file from sd card, unlike previous type this type cannot be interrupted and will be excuted until the end. This one is used with the command [ESP700]/sd/myfile.gco
The file name must have the /sd/ prefix to be sure that the file is handled properly. The [ESP701] command do not handle it. The file should only contain few commands and it is used by macros only
This type will be added to the script queue and processed FIFO

E- Invalid
The type is not yet identified, this type cannot be streamed and will raise an error.
</code></pre>
<p>2 - Streaming Queues
There are 3 types of queues for streams
A - Stream queue
This queue contain sd streams and fs streams, this queue has lower processing priority than script queue, which mean when the stream reach some state it can be interrupted, put in hold, and resumed.
The active stream of this queue can be monitored and controlled with the command [ESP701]
B - Script queue
This queue contains single commands, multiple commands, sd scripts and fs scripts. The queue has higher priority than script queue and will be processed before the stream queue. There is not control of this queue from user point of view.</p>
<pre><code>C - Emmergency Queue =&gt; TBC
This queue contain single commands that will be executed as soon as possible.
</code></pre>
<p>3 - Streaming queue states
The stream states only applied streams queue and only to the active stream, not to scripts queue.
A - idle
The streams queue is empty, but the scripts queue may not be empty
B - processing
It means at least one stream in streams queue is being processed, even in hold due to scripts queue not being empty.
C - paused
The current stream in stream queue is paused.
D - error
Currently not implemented because when a stream go to error it is removed from stream queue to process the next one in stream queue if any.</p>
<p>3 - Stream command states
The stream command states cover all states of a processed command.
A - Undefined
The state is undefined and the command will go to error state.
B - Start
This is the state to start a command or resume it. Next state is normally Ready to read cursor.</p>
<pre><code>C - Ready to read cursor
This is the state before really processing command, this is the state used to put a stream in hold to allow scripts queue or to respond to external change of state for stream like pause/abort. If not change state requested then the next state will be read cursor state
D - Read Cursor
This state read coming processing command from file/multiple commands line or single command.
According to the command the next state will be send gcode command state or send esp command state.
E - Send gcode command
Send gcode command to the output client, the command may have been completed with line number and checksum if is requested.
Depending of the command the next state will be wait for ack if an ack is requested or ready to read next command if no ack is requested.
F - Send esp command
The command has been identified as ESP command, so it will be handled internaly and response will be sent to the original client
The next state will be ready to read next command.

G - Wait for ack
If the command has been identified as GCode command and this command will send an ack, this state it to wait for it, if no ack received before a specific timout the next state will be the error state, if the ack is received before timeout then the next state will be ready to read next command.
H - Resend gcode command
In case of GCode command that is completed with line number and checksum and if there a checksum error received, this state will be resend the current gcode command again, ater a specific amount of failure the command will go to the error state.
I - Pause
This state will make the current stream queue on hold and process add a specific script to scripts queue if defined in settings, the next state will be paused.
J - Paused
This state will be waiting for resume or abort request to complete the stream.
K - Resume
If the current stream is paused it will resume it by adding a specific script to scripts queue if .defined in settings, and changing the next state as ready to read next command
L - Abort
This state will abort the current stream by adding a specific script to scripts queue if .defined in settings and changing the next state as end for the next command.
M - End
This state will close the current stream and remove it from the corresponding queue.
N - Error
If there is an error during the stream processing the error state will be raised, this state will  notify the user about the error and the next state will be end state to remove failing stream.
</code></pre>
<h2 id="operations">Operations</h2>
<p>the streaming is a loop of different operations
1 - Check external notifications / requests
This will check if there is an external request for change stream status e.g: pause or resume or abort</p>
<p>2 - Check what is the current active stream
This will check if there is a need of switching between queues and so switch between active streams, emmergency commands queue &gt; scripts queue &gt; streams queue</p>
<p>3 - Check what is the current active stream state
This will check if there is a need of changing the current state of the current active stream and applied it</p>
<p>4 - Check the client rx queue and process it
This will check if there is response  / command in the rx queue, parse the response if necessary to search for a command ack, add any external command to the stream queue coming, etc&hellip;</p>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="/js/clipboard.min.js?1722688348" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1722688348" defer></script>
    <script src="/js/theme.js?1722688348" defer></script>
  </body>
</html>
