<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.126.3">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="API description">
    <meta name="author" content="Luc LEBOSSE">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="API :: ESP3D Ecosystem">
    <meta name="twitter:description" content="API description">
    <meta property="og:url" content="http://localhost:1313/esp3d-tft/v1.x/documentation/api/index.html">
    <meta property="og:site_name" content="ESP3D Ecosystem">
    <meta property="og:title" content="API :: ESP3D Ecosystem">
    <meta property="og:description" content="API description">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="API :: ESP3D Ecosystem">
    <meta itemprop="description" content="API description">
    <meta itemprop="wordCount" content="42">
    <title>API :: ESP3D Ecosystem</title>
    <link href="http://localhost:1313/esp3d-tft/v1.x/documentation/api/index.html" rel="canonical" type="text/html" title="API :: ESP3D Ecosystem">
    <link href="/esp3d-tft/v1.x/documentation/api/index.xml" rel="alternate" type="application/rss+xml" title="API :: ESP3D Ecosystem">
    <link href="/images/favicon.ico?1722688342" rel="icon" type="image/x-icon" sizes="any">
    <link href="/css/fontawesome-all.min.css?1722688348" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1722688348" rel="stylesheet"></noscript>
    <link href="/css/nucleus.css?1722688348" rel="stylesheet">
    <link href="/css/auto-complete.css?1722688348" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1722688348" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1722688348" rel="stylesheet">
    <link href="/css/fonts.css?1722688348" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1722688348" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1722688348" rel="stylesheet">
    <link href="/css/theme-blue.css?1722688348" rel="stylesheet" id="R-variant-style">
    <link href="/css/chroma-learn.css?1722688348" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/css/variant.css?1722688348" rel="stylesheet">
    <link href="/css/print.css?1722688348" rel="stylesheet" media="print">
    <link href="/css/format-print.css?1722688348" rel="stylesheet">
    <script src="/js/variant.js?1722688348"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.index_js_url="/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'blue' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support print" data-url="/esp3d-tft/v1.x/documentation/api/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">ESP3D Ecosystem</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/index.html"><span itemprop="name">ESP3D-TFT</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/v1.x/index.html"><span itemprop="name">Version 1.X</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/esp3d-tft/v1.x/documentation/index.html"><span itemprop="name">Documentation</span></a><meta itemprop="position" content="4">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">API</span><meta itemprop="position" content="5"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/esp3d-tft/v1.x/documentation/faq/index.html" title="FAQ (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/esp3d-tft/v1.x/documentation/api/project-arch/index.html" title="Project architecture reference (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
<h1 id="api">API</h1>

<ul class="children children-li children-sort-weight">
	
<li><a href="/esp3d-tft/v1.x/documentation/api/project-arch/index.html">Project architecture reference</a><p>Project content and files organization</p></li>
<li><a href="/esp3d-tft/v1.x/documentation/api/webhandlers/index.html">Web Handlers</a><p>Web handlers description and parameters</p></li>
<li><a href="/esp3d-tft/v1.x/documentation/api/clients/index.html">Clients</a><p>Clients description, messages and parameters</p></li>
<li><a href="/esp3d-tft/v1.x/documentation/api/websockets/index.html">Web Sockets</a><p>Web Sockets description, messages and parameters</p></li>
<li><a href="/esp3d-tft/v1.x/documentation/api/conventions/index.html">Syntax conventions</a><p>Syntax conventions in used languages</p></li>
<li><a href="/esp3d-tft/v1.x/documentation/api/streamingservice/index.html">GCode streaming API</a><p>Streaming desctiption and API</p></li>
<li><a href="/esp3d-tft/v1.x/documentation/api/webdavservice/index.html">WebDAV API</a><p>WebDav usage and API</p></li>
</ul>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of API</h1>
          <article class="chapter">
<h1 id="project-architecture-reference">Project architecture reference</h1>
<h2 id="introduction">Introduction</h2>
<p>The Goal of this document is to provide a high level overview of the project architecture. This document is a work in progress and will be updated as the project evolves.</p>
<h2 id="files-and-directories">Files and Directories</h2>
<p>The project is organized into the following directories:</p>
<ul>
<li><code>cmake</code>: Contains the cmake files for the project and for each target</li>
<li><code>components</code>: Contains the main components of the project</li>
<li><code>customization</code>: Contains the customization files for the project to avoid to change in sources</li>
<li><code>docs</code>: Contains project documentation</li>
<li><code>embedded</code>: Contains the code for embedded maintenance web page of the firmware</li>
<li><code>hardware</code>: Contains the hardware specific files like drivers, partitions description, specific sdkconfig, hardware configuration files</li>
<li><code>resources</code>: Contains the graphical resources like logo for bootsplash, icons, etc</li>
<li><code>main</code>: Contains the main code of the project</li>
<li><code>scripts</code>: Contains the scripts used for the project like the fonts builder, the language pack builder, etc</li>
<li><code>tools</code>: Contains the tools used for the project to test features</li>
<li><code>translations</code>: Contains the language files for the firmware</li>
<li><code>CMakelists.txt</code>: The main CMake file for the project</li>
<li><code>LICENSE</code>: The license file for the project</li>
<li><code>README.md</code>: The main readme file for the project</li>
<li><code>.gitignore</code>: The git ignore file for the project</li>
<li><code>.gitmodules</code>: The git submodules file for the project</li>
<li><code>.github</code>: The github actions directory for the project</li>
</ul>
<h3 id="cmake-directory">cmake directory</h3>
<p>The <code>cmake</code> directory contains the cmake files for the project and for each target. The cmake files are organized into the following files and subdirectories:</p>
<ul>
<li><code>dev_tools.cmake</code>: Contains the cmake file for the development tools (log level, benchmark, log color, etc), this file can be edited but only for debug purpose</li>
<li><code>features.cmake</code>: Contains the cmake file for the features of the project (wifi, webserver, etc)</li>
<li><code>sanity_check.cmake</code>: Contains the cmake file for the sanity check of the project</li>
<li><code>targets.cmake</code>: Complete the cmake file of the project according target board</li>
<li><code>targets</code> directory : contains the cmake file for each target board, the file is named as the target board name</li>
</ul>
<p>Each target file contains the following sections:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code># Ensure the board is enabled in CMakeLists.txt
if(&lt;BOARD_NAME&gt;) #&lt;BOARD_NAME&gt; is enabled or not in CMakeLists.txt
    # Add board name (Mandatory)
    set(TFT_TARGET &#34;&lt;BOARD_NAME&gt;&#34;)
    # Add the sdkconfig file path (Mandatory), it can be specific or based on one of the common sdkconfig   
    set(SDKCONFIG  ${CMAKE_SOURCE_DIR}/hardware/&lt;BOARD_NAME&gt;/sdkconfig)
    # Add Specific Components if any for the board (Mandatory)
    list(APPEND EXTRA_COMPONENT_DIRS ${CMAKE_SOURCE_DIR}/hardware/&lt;BOARD_NAME&gt;/components)
    # Add specific usb driver for otg (Only if needed)
    list(APPEND EXTRA_COMPONENT_DIRS ${CMAKE_SOURCE_DIR}/hardware/drivers_usb_otg)
    # Add specific video driver for i80 (Only if needed)
    list(APPEND EXTRA_COMPONENT_DIRS ${CMAKE_SOURCE_DIR}/hardware/drivers_video_i80)
    # Add specific video driver for rgb (Only if needed)
    list(APPEND EXTRA_COMPONENT_DIRS ${CMAKE_SOURCE_DIR}/hardware/rgb)
    # Add specific bsp path for board definition (Mandatory)
    add_compile_options(&#34;-I${CMAKE_SOURCE_DIR}/hardware/&lt;BOARD_NAME&gt;/components/bsp&#34;)
    # Enable USB-OTG as serial alternative for communications (Only if needed)
    add_compile_options(-DESP3D_USB_SERIAL_FEATURE=1)
endif()</code></pre></div><h3 id="components-directory">components directory</h3>
<p>The <code>components</code> directory contains the main components of the project. The components are organized into the following subdirectories:</p>
<ul>
<li><code>esp_litlefs</code>: Contains the code for the LittleFS file system</li>
<li><code>esp3d_log</code>: Contains the code for the logging system</li>
<li><code>lvgl</code>: Contains the code for the LittlevGL graphics library</li>
<li><code>mdns</code>: Contains the code for the mDNS service</li>
<li><code>SSDP_IDF</code>: Contains the code for the SSDP service</li>
</ul>
<p>Note SSDP_IDF and esp_littlefs are actually defined as git submodules.</p>
<h3 id="customizations-directory">customizations directory</h3>
<p>The <code>customizations</code> directory contains the customization files for the project. The customization files are organized into the following subdirectories:</p>
<ul>
<li><code>notifications</code>: Contains the customization strings for the notifications</li>
<li><code>ssdp</code>: Contains the customization strings for the SSDP service</li>
</ul>
<h3 id="docs-directory">docs directory</h3>
<h4 id="embedded-directory">embedded directory</h4>
<p>The <code>embedded</code> directory contains the code for the embedded maintenance web page of the firmware. The code is organized into the following subdirectories:</p>
<ul>
<li>
<p><code>assets</code>: Contains the assets for the embedded maintenance web page</p>
<ul>
<li><code>favicon.ico</code>: The favicon for the embedded maintenance web page</li>
<li><code>header.txt</code>: The header for the embedded maintenance web page</li>
<li><code>footer.txt</code>: The footer for the embedded maintenance web page</li>
</ul>
</li>
<li>
<p><code>config</code>: Contains the configuration files for the test server and production page</p>
<ul>
<li><code>buildassets.js</code>: This script will convert the binaries assets into a C header file</li>
<li><code>server.js</code>: The test server for the embedded maintenance web page</li>
<li><code>webpack.dev.js</code>: The webpack configuration for the test server and test page</li>
<li><code>webpack.prod.js</code>: The webpack configuration for the production page</li>
</ul>
</li>
<li>
<p><code>dist</code>: Contains the binary distribution file for the embedded maintenance web page</p>
</li>
<li>
<p><code>server</code>: Is the directory that simulate the local flash system for the upload</p>
</li>
<li>
<p><code>src</code>: Contains the source code for the embedded maintenance web page</p>
<ul>
<li><code>index.html</code>: The main html file for the embedded maintenance web page</li>
<li><code>index.js</code>: The main javascript file for the embedded maintenance web page</li>
<li><code>menu.js</code>: The menu javascript file for the embedded maintenance web page</li>
<li><code>style.css</code>: The main css file for the embedded maintenance web page</li>
</ul>
</li>
<li>
<p><code>package.json</code>: The package file for the embedded maintenance web page</p>
</li>
<li>
<p><code>Notes.txt</code>: The notes file for the embedded maintenance web page</p>
</li>
<li>
<p><code>.gitignore</code>: The git ignore file for the embedded maintenance web page</p>
</li>
</ul>
<h4 id="hardware-directory">hardware directory</h4>
<p>The <code>hardware</code> directory contains the hardware specific files like drivers, partitions description, specific sdkconfig, hardware configuration files. The hardware specific files are organized into one common subdirectory and one subdirectory for each supported hardware platform.</p>
<ul>
<li><code>common</code>: Contains the common hardware specific files like  partitions description, specific sdkconfig</li>
<li><code>drivers_common</code>: Contains the common drivers for all the boards</li>
<li><code>drivers_video_i80</code>: Contains the drivers for the i80 video drivers which cannot be in common drivers because of the specific sdkconfig</li>
<li><code>drivers_video_rgb</code>: Contains the drivers for the rgb video drivers which cannot be in common drivers because of the specific sdkconfig</li>
<li><code>drivers_usb_otg</code>: Contains the drivers for the usb otg which cannot be in common drivers because of the specific sdkconfig and hardware</li>
<li><code>&lt;BOARD_NAME&gt;</code>: Contains the hardware drivers, definitions, partitions and sdkconfig specific files for the &lt;BOARD_NAME&gt; board</li>
<li>&hellip;</li>
</ul>
<table>
<thead>
<tr>
<th>Drivers</th>
<th>Type</th>
<th>Depend</th>
<th style="text-align:center">ESP32_2432S028R</th>
<th style="text-align:center">ESP32_3248S035C</th>
<th style="text-align:center">ESP32_3248S035R</th>
<th style="text-align:center">ESP32_ROTRICS_DEXARM35</th>
<th style="text-align:center">ESP32_CUSTOM</th>
</tr>
</thead>
<tbody>
<tr>
<td>disp_backlight</td>
<td>Display component</td>
<td>esp3d_log driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>disp_spi</td>
<td></td>
<td>esp3d_log driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>ili9341</td>
<td>SPI Display</td>
<td>esp3d_log esp_lcd driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>ili9488</td>
<td></td>
<td>esp3d_log lvgl disp_spi</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>st7796</td>
<td>SPI Display</td>
<td>esp3d_log esp_lcd driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>xpt2046</td>
<td>SPI Touch</td>
<td>esp3d_log driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>gt911</td>
<td></td>
<td>esp3d_log i2c_bus</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>ft5x06</td>
<td></td>
<td>esp3d_log lvgl i2c_bus</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>i2c_bus</td>
<td></td>
<td>esp3d_log driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>spi_bus</td>
<td>SPI Bus</td>
<td>esp3d_log driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>sw_spi</td>
<td>Software SPI</td>
<td>esp3d_log driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Drivers</th>
<th>Type</th>
<th>Depend</th>
<th style="text-align:center">ESP32S3_4827S043C</th>
<th style="text-align:center">ESP32S3_8048S043C</th>
<th style="text-align:center">ESP32S3_8048S050C</th>
<th style="text-align:center">ESP32S3_8048S070C</th>
<th style="text-align:center">ESP32S3_BZM_TFT35_GT911</th>
<th style="text-align:center">ESP32S3_HMI43V3</th>
<th style="text-align:center">ESP32S3_ZX3D50CE02S_USRC_4832</th>
<th style="text-align:center">ESP32S3_CUSTOM</th>
</tr>
</thead>
<tbody>
<tr>
<td>disp_backlight</td>
<td>Display component</td>
<td>esp3d_log driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>st7796</td>
<td>i80 Display</td>
<td>esp3d_log esp_lcd driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>ili9485</td>
<td>RGB Display</td>
<td>esp3d_log esp_lcd driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>st7262</td>
<td>RGB Display</td>
<td>esp3d_log esp_lcd driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>ek9716</td>
<td>RGB Display</td>
<td>esp3d_log lvgl esp_lcd driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>rm68120</td>
<td>i80 Display</td>
<td>esp3d_log lvgl esp_lcd driver</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>ft5x06</td>
<td>i2c Touch</td>
<td>esp3d_log lvgl i2c_bus</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>gt911</td>
<td>i2c Touch</td>
<td>esp3d_log i2c_bus</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>tca9554</td>
<td>IO expander</td>
<td>esp3d_log i2c_bus</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>i2c_bus</td>
<td>i2c Bus</td>
<td>esp3d_log driver</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">O</td>
</tr>
<tr>
<td>usb_serial</td>
<td>OTG Host</td>
<td>esp3d_log</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">O</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
</tbody>
</table>
<h3 id="bus-drivers">Bus drivers</h3>
<ul>
<li>spi_bus driver
The <code>spi_bus</code> driver is a SPI bus driver that is used to control the SPI bus. The <code>spi_bus</code> driver configuration is part of display driver configuration.
in disp_def.h:</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// SPI (dedicated or shared)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>.spi_bus_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        .spi_host_index <span style="color:#f92672">=</span> SPI2_HOST,
</span></span><span style="display:flex;"><span>        .pin_miso <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>,                       <span style="color:#75715e">/**&lt; MISO pin number */</span>
</span></span><span style="display:flex;"><span>        .pin_mosi <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>,                       <span style="color:#75715e">/**&lt; MOSI pin number */</span>
</span></span><span style="display:flex;"><span>        .pin_clk <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>,                        <span style="color:#75715e">/**&lt; CLK pin number */</span>
</span></span><span style="display:flex;"><span>        .is_master <span style="color:#f92672">=</span> true,                    <span style="color:#75715e">/**&lt; SPI master mode */</span>
</span></span><span style="display:flex;"><span>        .max_transfer_sz <span style="color:#f92672">=</span> DISP_BUF_SIZE <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>, <span style="color:#75715e">/**&lt; Maximum transfer size */</span>
</span></span><span style="display:flex;"><span>        .dma_channel <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,                     <span style="color:#75715e">/**&lt; DMA channel */</span>
</span></span><span style="display:flex;"><span>        .quadwp_io_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,                  <span style="color:#75715e">/**&lt; QuadWP pin number */</span>
</span></span><span style="display:flex;"><span>        .quadhd_io_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>                   <span style="color:#75715e">/**&lt; QuadHD pin number */</span>
</span></span><span style="display:flex;"><span>    },</span></span></code></pre></div><ul>
<li>sw_spi driver
The <code>sw_spi</code> driver is a software SPI driver that is used to control the SPI bus. The <code>sw_spi</code> driver configuration is part of the driver configuration file which use it.</li>
</ul>
<p>eg: touch driver use it, so it can be part of the touch driver configuration.</p>
<p>touch_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// SPI (BitBang)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> sw_spi_config_t touch_spi_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .cs_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">33</span>,   <span style="color:#75715e">// GPIO 33
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .clk_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>,  <span style="color:#75715e">// GPIO 25
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .mosi_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>, <span style="color:#75715e">// GPIO 33
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .miso_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">39</span>, <span style="color:#75715e">// GPIO 39
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};</span></span></code></pre></div><ul>
<li>i2c_bus driver
The <code>i2c_bus</code> driver is a I2C bus driver that is used to control the I2C bus. The <code>i2c_bus</code> driver configuration file is i2c_def.h.</li>
</ul>
<p>bsp.c:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//define the I2C bus 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define I2C_PORT_NUMBER   0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// I2C pins definition
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> i2c_config_t i2c_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .mode <span style="color:#f92672">=</span> I2C_MODE_MASTER,
</span></span><span style="display:flex;"><span>    .scl_io_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>, <span style="color:#75715e">// GPIO 20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .sda_io_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, <span style="color:#75715e">// GPIO 19
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .scl_pullup_en <span style="color:#f92672">=</span> GPIO_PULLUP_ENABLE,
</span></span><span style="display:flex;"><span>    .sda_pullup_en <span style="color:#f92672">=</span> GPIO_PULLUP_ENABLE,
</span></span><span style="display:flex;"><span>    .master.clk_speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><ul>
<li>tca9554 driver
The <code>tca9554</code> driver is a I2C GPIO expander driver that is used to control the TCA9554 GPIO expander. The <code>tca9554</code> driver configuration file is tca9554_def.h.</li>
</ul>
<p>tca9554_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> tca9554_config_t tca9554_cfg <span style="color:#f92672">=</span> {.i2c_clk_speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>                                      .i2c_addr <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint8_t</span>[]){<span style="color:#ae81ff">0x3C</span>, <span style="color:#ae81ff">0x24</span>, <span style="color:#ae81ff">0</span>}};</span></span></code></pre></div><ul>
<li>usb_serial driver
The <code>usb_serial</code> driver is a USB serial driver that is used to control the OTG USB serial. The <code>usb_serial</code> driver configuration usb_serial_def.h.</li>
</ul>
<p>usb_serial_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define ESP3D_USB_SERIAL_BAUDRATE &#34;115200&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define ESP3D_USB_SERIAL_DATA_BITS (8)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define ESP3D_USB_SERIAL_PARITY \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  (0)  </span><span style="color:#75715e">// 0: 1 stopbit, 1: 1.5 stopbits, 2: 2 stopbits
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define ESP3D_USB_SERIAL_STOP_BITS \
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  (0)  </span><span style="color:#75715e">// 0: None, 1: Odd, 2: Even, 3: Mark, 4: Space
</span></span></span></code></pre></div><h3 id="spi-display-drivers">SPI Display drivers</h3>
<ul>
<li>ili9341 driver
The <code>ili9341</code> driver is a SPI display driver that is used to control the ILI9341 display. The <code>ili9341</code> driver configuration is part of display driver configuration.</li>
</ul>
<p>in disp_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define DISP_HOR_RES_MAX 320
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_VER_RES_MAX 240
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_USE_DOUBLE_BUFFER (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if WITH_PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// 1/10 (24-line) buffer (15KB) in external PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * DISP_VER_RES_MAX / 10)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_MALLOC_TYPE MALLOC_CAP_SPIRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// 1/20 (12-line) buffer (7.5KB) in internal DRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * 12)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_MALLOC_TYPE MALLOC_CAP_DMA
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif  </span><span style="color:#75715e">// WITH_PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE_BYTES (DISP_BUF_SIZE * 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Display configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>esp_spi_ili9341_config_t display_spi_ili9341_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .panel_dev_config <span style="color:#f92672">=</span> {.reset_gpio_num <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                             <span style="color:#ae81ff">4</span>,  <span style="color:#75715e">// GPIO 4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                         .rgb_ele_order <span style="color:#f92672">=</span> LCD_RGB_ELEMENT_ORDER_BGR,
</span></span><span style="display:flex;"><span>                         .data_endian <span style="color:#f92672">=</span> LCD_RGB_DATA_ENDIAN_BIG,
</span></span><span style="display:flex;"><span>                         .bits_per_pixel <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>                         .flags <span style="color:#f92672">=</span> {.reset_active_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>},
</span></span><span style="display:flex;"><span>                         .vendor_config <span style="color:#f92672">=</span> NULL},
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .spi_bus_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .spi_host_index <span style="color:#f92672">=</span> SPI2_HOST,
</span></span><span style="display:flex;"><span>            .pin_miso <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>,                       <span style="color:#75715e">/**&lt; MISO pin number */</span>
</span></span><span style="display:flex;"><span>            .pin_mosi <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>,                       <span style="color:#75715e">/**&lt; MOSI pin number */</span>
</span></span><span style="display:flex;"><span>            .pin_clk <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>,                        <span style="color:#75715e">/**&lt; CLK pin number */</span>
</span></span><span style="display:flex;"><span>            .is_master <span style="color:#f92672">=</span> true,                    <span style="color:#75715e">/**&lt; SPI master mode */</span>
</span></span><span style="display:flex;"><span>            .max_transfer_sz <span style="color:#f92672">=</span> DISP_BUF_SIZE <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>, <span style="color:#75715e">/**&lt; Maximum transfer size */</span>
</span></span><span style="display:flex;"><span>            .dma_channel <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,                     <span style="color:#75715e">/**&lt; DMA channel */</span>
</span></span><span style="display:flex;"><span>            .quadwp_io_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,                  <span style="color:#75715e">/**&lt; QuadWP pin number */</span>
</span></span><span style="display:flex;"><span>            .quadhd_io_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>                   <span style="color:#75715e">/**&lt; QuadHD pin number */</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .disp_spi_cfg <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {.dc_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#75715e">/*!&lt; GPIO used to select the D/C line, set this to -1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                              if the D/C line is not used */</span>
</span></span><span style="display:flex;"><span>         .cs_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>, <span style="color:#75715e">/*!&lt; GPIO used for CS line */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>         .spi_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,               <span style="color:#75715e">/*!&lt; Traditional SPI mode (0~3) */</span>
</span></span><span style="display:flex;"><span>         .pclk_hz <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>, <span style="color:#75715e">/*!&lt; Frequency of pixel clock */</span>
</span></span><span style="display:flex;"><span>         .trans_queue_depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,     <span style="color:#75715e">/*!&lt; Size of internal transaction queue */</span>
</span></span><span style="display:flex;"><span>         .on_color_trans_done <span style="color:#f92672">=</span> NULL, <span style="color:#75715e">/*!&lt; Callback invoked when color data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         transfer has finished */</span>
</span></span><span style="display:flex;"><span>         .user_ctx <span style="color:#f92672">=</span> NULL,            <span style="color:#75715e">/*!&lt; User private data, passed directly to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         on_color_trans_done&#39;s user_ctx */</span>
</span></span><span style="display:flex;"><span>         .lcd_cmd_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,           <span style="color:#75715e">/*!&lt; Bit-width of LCD command */</span>
</span></span><span style="display:flex;"><span>         .lcd_param_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,         <span style="color:#75715e">/*!&lt; Bit-width of LCD parameter */</span>
</span></span><span style="display:flex;"><span>         .flags <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 <span style="color:#75715e">/*!&lt; Extra flags to fine-tune the SPI device */</span>
</span></span><span style="display:flex;"><span>                 .dc_low_on_data <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; If this flag is enabled, DC line = 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         means transfer data, DC line = 1 means
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         transfer command; vice versa */</span>
</span></span><span style="display:flex;"><span>                 .octal_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; transmit with octal mode (8 data lines), this mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                           is used to simulate Intel 8080 timing */</span>
</span></span><span style="display:flex;"><span>                 .quad_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; transmit with quad mode (4 data lines), this mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                           is useful when transmitting LCD parameters (Only use
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                           one line for command) */</span>
</span></span><span style="display:flex;"><span>                 .sio_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; Read and write through a single data line (MOSI) */</span>
</span></span><span style="display:flex;"><span>                 .lsb_first <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,      <span style="color:#75715e">/*!&lt; transmit LSB bit first */</span>
</span></span><span style="display:flex;"><span>                 .cs_high_active <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; CS line is high active */</span>
</span></span><span style="display:flex;"><span>             }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .orientation <span style="color:#f92672">=</span> orientation_landscape,
</span></span><span style="display:flex;"><span>    .hor_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>    .ver_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><ul>
<li>st7796 spi driver
The <code>st7796</code> driver is a display driver that is used to control the ST7796 display. The <code>st7796</code> driver configuration is part of display driver configuration.</li>
</ul>
<p>disp_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define DISP_HOR_RES_MAX 480
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_VER_RES_MAX 320
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Display interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_USE_DOUBLE_BUFFER (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if WITH_PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// 1/10 (32-line) buffer (30KB) in external PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * DISP_VER_RES_MAX / 10)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_MALLOC_TYPE MALLOC_CAP_SPIRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// 1/40 (8-line) buffer (7.5KB) in internal DRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * 8)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_MALLOC_TYPE MALLOC_CAP_DMA
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif  </span><span style="color:#75715e">// WITH_PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE_BYTES (DISP_BUF_SIZE * 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// LCD panel configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>esp_spi_st7262_config_t display_spi_st7262_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .panel_dev_config <span style="color:#f92672">=</span> {.reset_gpio_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                         .rgb_ele_order <span style="color:#f92672">=</span> LCD_RGB_ELEMENT_ORDER_BGR,
</span></span><span style="display:flex;"><span>                         .data_endian <span style="color:#f92672">=</span> LCD_RGB_DATA_ENDIAN_BIG,
</span></span><span style="display:flex;"><span>                         .bits_per_pixel <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>                         .flags <span style="color:#f92672">=</span> {.reset_active_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>},
</span></span><span style="display:flex;"><span>                         .vendor_config <span style="color:#f92672">=</span> NULL},
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    .spi_bus_config <span style="color:#f92672">=</span>  <span style="color:#75715e">// SPI (shared with Touch)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    {
</span></span><span style="display:flex;"><span>        .spi_host_index <span style="color:#f92672">=</span> SPI2_HOST,
</span></span><span style="display:flex;"><span>        .pin_miso <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>,                       <span style="color:#75715e">/**&lt; MISO pin number */</span>
</span></span><span style="display:flex;"><span>        .pin_mosi <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>,                       <span style="color:#75715e">/**&lt; MOSI pin number */</span>
</span></span><span style="display:flex;"><span>        .pin_clk <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>,                        <span style="color:#75715e">/**&lt; CLK pin number */</span>
</span></span><span style="display:flex;"><span>        .is_master <span style="color:#f92672">=</span> true,                    <span style="color:#75715e">/**&lt; SPI master mode */</span>
</span></span><span style="display:flex;"><span>        .max_transfer_sz <span style="color:#f92672">=</span> DISP_BUF_SIZE <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>, <span style="color:#75715e">/**&lt; Maximum transfer size */</span>
</span></span><span style="display:flex;"><span>        .dma_channel <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,                     <span style="color:#75715e">/**&lt; DMA channel */</span>
</span></span><span style="display:flex;"><span>        .quadwp_io_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,                  <span style="color:#75715e">/**&lt; QuadWP pin number */</span>
</span></span><span style="display:flex;"><span>        .quadhd_io_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>                   <span style="color:#75715e">/**&lt; QuadHD pin number */</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    .disp_spi_cfg <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {.cs_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>, <span style="color:#75715e">/*!&lt; GPIO used for CS line */</span>
</span></span><span style="display:flex;"><span>         .dc_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#75715e">/*!&lt; GPIO used to select the D/C line, set this to -1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                              if the D/C line is not used */</span>
</span></span><span style="display:flex;"><span>         .spi_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,    <span style="color:#75715e">/*!&lt; Traditional SPI mode (0~3) */</span>
</span></span><span style="display:flex;"><span>         .pclk_hz <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>, <span style="color:#75715e">/*!&lt; Frequency of pixel clock */</span>
</span></span><span style="display:flex;"><span>         .trans_queue_depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,     <span style="color:#75715e">/*!&lt; Size of internal transaction queue */</span>
</span></span><span style="display:flex;"><span>         .on_color_trans_done <span style="color:#f92672">=</span> NULL, <span style="color:#75715e">/*!&lt; Callback invoked when color data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         transfer has finished */</span>
</span></span><span style="display:flex;"><span>         .user_ctx <span style="color:#f92672">=</span> NULL,            <span style="color:#75715e">/*!&lt; User private data, passed directly to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         on_color_trans_done&#39;s user_ctx */</span>
</span></span><span style="display:flex;"><span>         .lcd_cmd_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,           <span style="color:#75715e">/*!&lt; Bit-width of LCD command */</span>
</span></span><span style="display:flex;"><span>         .lcd_param_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,         <span style="color:#75715e">/*!&lt; Bit-width of LCD parameter */</span>
</span></span><span style="display:flex;"><span>         .flags <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 <span style="color:#75715e">/*!&lt; Extra flags to fine-tune the SPI device */</span>
</span></span><span style="display:flex;"><span>                 .dc_low_on_data <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; If this flag is enabled, DC line = 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         means transfer data, DC line = 1 means
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                         transfer command; vice versa */</span>
</span></span><span style="display:flex;"><span>                 .octal_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; transmit with octal mode (8 data lines), this mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                           is used to simulate Intel 8080 timing */</span>
</span></span><span style="display:flex;"><span>                 .quad_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; transmit with quad mode (4 data lines), this mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                           is useful when transmitting LCD parameters (Only use
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                           one line for command) */</span>
</span></span><span style="display:flex;"><span>                 .sio_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; Read and write through a single data line (MOSI) */</span>
</span></span><span style="display:flex;"><span>                 .lsb_first <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,      <span style="color:#75715e">/*!&lt; transmit LSB bit first */</span>
</span></span><span style="display:flex;"><span>                 .cs_high_active <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; CS line is high active */</span>
</span></span><span style="display:flex;"><span>             }},
</span></span><span style="display:flex;"><span>    .orientation <span style="color:#f92672">=</span> orientation_landscape,
</span></span><span style="display:flex;"><span>    .hor_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>    .ver_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><h3 id="rgb-display-drivers">RGB Display drivers</h3>
<ul>
<li>st7262 driver
The <code>st7262</code> driver is a RGB display driver that is used to control the ST7262 display. The <code>st7262</code> driver configuration is part of display driver configuration.</li>
</ul>
<p>in disp_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define DISP_HOR_RES_MAX 800
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_VER_RES_MAX 480
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_CLK_FREQ (14 * 1000 * 1000)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_AVOID_TEAR_EFFECT_WITH_SEM (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_USE_BOUNCE_BUFFER (false)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_USE_DOUBLE_BUFFER (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_NUM_FB (1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_PATCH_FS_FREQ (6 * 1000 * 1000)  </span><span style="color:#75715e">// 6MHz
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_PATCH_FS_DELAY (40)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if DISP_NUM_FB == 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// Full frame buffer (255KB) in external PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * DISP_VER_RES_MAX)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// 1/4 (68-line) buffer (63.75KB) in external PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * DISP_VER_RES_MAX / 4)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif  </span><span style="color:#75715e">// WITH_PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BUF_SIZE_BYTES (DISP_BUF_SIZE * 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> esp_rgb_st7262_config_t disp_panel_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .panel_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {.clk_src <span style="color:#f92672">=</span> LCD_CLK_SRC_DEFAULT,
</span></span><span style="display:flex;"><span>         .timings <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 .pclk_hz <span style="color:#f92672">=</span> DISP_CLK_FREQ,
</span></span><span style="display:flex;"><span>                 .h_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>                 .v_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>                 .hsync_pulse_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>                 .hsync_back_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>                 .hsync_front_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>                 .vsync_pulse_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>                 .vsync_back_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>                 .vsync_front_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>                 .flags <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     {
</span></span><span style="display:flex;"><span>                         .hsync_idle_low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                         .vsync_idle_low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                         .de_idle_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                         .pclk_active_neg <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>                         .pclk_idle_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                     },
</span></span><span style="display:flex;"><span>             },
</span></span><span style="display:flex;"><span>         .data_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,  <span style="color:#75715e">// RGB565 in parallel mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .bits_per_pixel <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>         .num_fbs <span style="color:#f92672">=</span> DISP_NUM_FB,
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if DISP_USE_BOUNCE_BUFFER
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .bounce_buffer_size_px <span style="color:#f92672">=</span> DISP_BUF_SIZE,
</span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          .bounce_buffer_size_px <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .sram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>         .psram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>,
</span></span><span style="display:flex;"><span>         .hsync_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">39</span>,  <span style="color:#75715e">// GPIO 39
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .vsync_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>,  <span style="color:#75715e">// GPIO 41
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .de_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>,     <span style="color:#75715e">// GPIO 40
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .pclk_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>,   <span style="color:#75715e">// GPIO 42
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .disp_gpio_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// EN pin not connected
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         .data_gpio_nums <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 <span style="color:#ae81ff">8</span>,   <span style="color:#75715e">// D0  (B0) - GPIO 8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">3</span>,   <span style="color:#75715e">// D1  (B1) - GPIO 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">46</span>,  <span style="color:#75715e">// D2  (B2) - GPIO 46
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">9</span>,   <span style="color:#75715e">// D3  (B3) - GPIO 9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// D4  (B4) - GPIO 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">5</span>,   <span style="color:#75715e">// D5  (G0) - GPIO 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">6</span>,   <span style="color:#75715e">// D6  (G1) - GPIO 6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">7</span>,   <span style="color:#75715e">// D7  (G2) - GPIO 7
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">15</span>,  <span style="color:#75715e">// D8  (G3) - GPIO 15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">16</span>,  <span style="color:#75715e">// D9  (G4) - GPIO 16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">4</span>,   <span style="color:#75715e">// D10 (G5) - GPIO 4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">45</span>,  <span style="color:#75715e">// D11 (R0) - GPIO 45
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">48</span>,  <span style="color:#75715e">// D12 (R1) - GPIO 48
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">47</span>,  <span style="color:#75715e">// D13 (R2) - GPIO 47
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">21</span>,  <span style="color:#75715e">// D14 (R3) - GPIO 21
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 <span style="color:#ae81ff">14</span>,  <span style="color:#75715e">// D15 (R4) - GPIO 14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>             },
</span></span><span style="display:flex;"><span>         .flags <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>             {
</span></span><span style="display:flex;"><span>                 .disp_active_low <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>                 .refresh_on_demand <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>                 .fb_in_psram <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                     true,  <span style="color:#75715e">// Do not change this, as it is mandatory for RGB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            <span style="color:#75715e">// parallel interface and octal PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                 .double_fb <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>                 .no_fb <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>                 .bb_invalidate_cache <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>             }},
</span></span><span style="display:flex;"><span>    .orientation <span style="color:#f92672">=</span> orientation_landscape,
</span></span><span style="display:flex;"><span>    .hor_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>    .ver_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><ul>
<li>ek9716 driver
The <code>ek9716</code> driver is a RGB display driver that is used to control the EK9716 display. The <code>ek9716</code> driver configuration is part of display driver configuration.</li>
</ul>
<p>in disp_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define DISP_HOR_RES_MAX 800
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_VER_RES_MAX 480
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_AVOID_TEAR_EFFECT_WITH_SEM (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_USE_BOUNCE_BUFFER  (false)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_USE_DOUBLE_BUFFER  (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_NUM_FB             (1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_CLK_FREQ (16 * 1000 * 1000)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_PATCH_FS_FREQ (6 * 1000 * 1000)  </span><span style="color:#75715e">// 6MHz
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_PATCH_FS_DELAY  (40)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if DISP_NUM_FB == 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// Full frame buffer (255KB) in external PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * DISP_VER_RES_MAX)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// 1/4 (68-line) buffer (63.75KB) in external PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * DISP_VER_RES_MAX / 4)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif  </span><span style="color:#75715e">// WITH_PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_SIZE_BYTES    (DISP_BUF_SIZE * 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">//Panel configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> esp_rgb_ek9716_config_t disp_panel_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .panel_config <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .clk_src <span style="color:#f92672">=</span> LCD_CLK_SRC_DEFAULT,
</span></span><span style="display:flex;"><span>    .timings <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        .pclk_hz <span style="color:#f92672">=</span> DISP_CLK_FREQ ,
</span></span><span style="display:flex;"><span>        .h_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>        .v_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>        .hsync_pulse_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>,
</span></span><span style="display:flex;"><span>        .hsync_back_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>        .hsync_front_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">210</span>,
</span></span><span style="display:flex;"><span>        .vsync_pulse_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>,
</span></span><span style="display:flex;"><span>        .vsync_back_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>        .vsync_front_porch <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>,
</span></span><span style="display:flex;"><span>        .flags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            .hsync_idle_low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            .vsync_idle_low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            .de_idle_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            .pclk_active_neg <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>            .pclk_idle_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    .data_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, <span style="color:#75715e">// RGB565 in parallel mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .bits_per_pixel <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    .num_fbs <span style="color:#f92672">=</span> DISP_NUM_FB,
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if DISP_USE_BOUNCE_BUFFER
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .bounce_buffer_size_px <span style="color:#f92672">=</span> DISP_BUF_SIZE,
</span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .bounce_buffer_size_px <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .sram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    .psram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>,
</span></span><span style="display:flex;"><span>    .hsync_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">39</span>, <span style="color:#75715e">// GPIO 39
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .vsync_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>, <span style="color:#75715e">// GPIO 40
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .de_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>, <span style="color:#75715e">// GPIO 41
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .pclk_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>, <span style="color:#75715e">// GPIO 42
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .disp_gpio_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">// EN pin not connected
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .data_gpio_nums <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">15</span>, <span style="color:#75715e">// D0  (B0) - GPIO 15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">7</span>,  <span style="color:#75715e">// D1  (B1) - GPIO 7
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">6</span>,  <span style="color:#75715e">// D2  (B2) - GPIO 6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">5</span>,  <span style="color:#75715e">// D3  (B3) - GPIO 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">4</span>,  <span style="color:#75715e">// D4  (B4) - GPIO 4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">9</span>,  <span style="color:#75715e">// D5  (G0) - GPIO 9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">46</span>, <span style="color:#75715e">// D6  (G1) - GPIO 46
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">3</span>,  <span style="color:#75715e">// D7  (G2) - GPIO 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">8</span>,  <span style="color:#75715e">// D8  (G3) - GPIO 8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">16</span>, <span style="color:#75715e">// D9  (G4) - GPIO 16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">1</span>,  <span style="color:#75715e">// D10 (G5) - GPIO 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">14</span>, <span style="color:#75715e">// D11 (R0) - GPIO 14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">21</span>, <span style="color:#75715e">// D12 (R1) - GPIO 21
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">47</span>, <span style="color:#75715e">// D13 (R2) - GPIO 47
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">48</span>, <span style="color:#75715e">// D14 (R3) - GPIO 48
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#ae81ff">45</span>, <span style="color:#75715e">// D15 (R4) - GPIO 45
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    },
</span></span><span style="display:flex;"><span>    .flags <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        .disp_active_low <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>        .refresh_on_demand <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>        .fb_in_psram <span style="color:#f92672">=</span> true, <span style="color:#75715e">// Do not change this, as it is mandatory for RGB parallel interface and octal PSRAM
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        .double_fb <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>        .no_fb <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>        .bb_invalidate_cache <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint32_t</span>)NULL,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>},
</span></span><span style="display:flex;"><span>    .orientation <span style="color:#f92672">=</span> orientation_landscape,
</span></span><span style="display:flex;"><span>    .hor_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>    .ver_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><h3 id="i80-display-drivers">i80 Display drivers</h3>
<ul>
<li>rm68120 driver
The <code>rm68120</code> driver is a display driver that is used to control the RM68120 display. The <code>rm68120</code> driver configuration is part of display driver configuration.</li>
</ul>
<p>disp_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define DISP_HOR_RES_MAX (800)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_VER_RES_MAX (480)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * (DISP_VER_RES_MAX / 10))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_USE_DOUBLE_BUFFER (true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> esp_i80_rm68120_config_t rm68120_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .bus_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .clk_src <span style="color:#f92672">=</span> LCD_CLK_SRC_DEFAULT,
</span></span><span style="display:flex;"><span>            .dc_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">38</span>,  <span style="color:#75715e">// DISP_RS_PIN=GPIO38
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .wr_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>,  <span style="color:#75715e">// DISP_WR_PIN=GPIO17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .data_gpio_nums <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// DISP_D00_PIN = GPIO1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">9</span>,   <span style="color:#75715e">// DISP_D01_PIN = GPIO9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">2</span>,   <span style="color:#75715e">// DISP_D02_PIN = GPIO2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">10</span>,  <span style="color:#75715e">// DISP_D03_PIN = GPIO10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">3</span>,   <span style="color:#75715e">// DISP_D04_PIN = GPIO3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">11</span>,  <span style="color:#75715e">// DISP_D05_PIN = GPIO11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">4</span>,   <span style="color:#75715e">// DISP_D06_PIN = GPIO4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">12</span>,  <span style="color:#75715e">// DISP_D07_PIN = GPIO12
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">5</span>,   <span style="color:#75715e">// DISP_D08_PIN = GPIO5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">13</span>,  <span style="color:#75715e">// DISP_D09_PIN = GPIO13
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">6</span>,   <span style="color:#75715e">// DISP_D10_PIN = GPIO6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">14</span>,  <span style="color:#75715e">// DISP_D11_PIN = GPIO14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">7</span>,   <span style="color:#75715e">// DISP_D12_PIN = GPIO7
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">15</span>,  <span style="color:#75715e">// DISP_D13_PIN = GPIO15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">8</span>,   <span style="color:#75715e">// DISP_D14_PIN = GPIO8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">16</span>,  <span style="color:#75715e">// DISP_D15_PIN = GPIO16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                },
</span></span><span style="display:flex;"><span>            .bus_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,  <span style="color:#75715e">// DISP_BITS_WIDTH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .max_transfer_bytes <span style="color:#f92672">=</span> DISP_BUF_SIZE <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">uint16_t</span>),
</span></span><span style="display:flex;"><span>            .psram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>,
</span></span><span style="display:flex;"><span>            .sram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .io_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .cs_gpio_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>            .pclk_hz <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ae81ff">1000</span>),  <span style="color:#75715e">// could be 10 if no PSRAM memory= DISP_CLK_FREQ,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .trans_queue_depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            .dc_levels <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    .dc_idle_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    .dc_cmd_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    .dc_dummy_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    .dc_data_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            .on_color_trans_done <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                NULL,  <span style="color:#75715e">// Callback invoked when color data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                       <span style="color:#75715e">// transfer has finished updated in bdsp.c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .user_ctx <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                NULL,  <span style="color:#75715e">// User private data, passed directly to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                       <span style="color:#75715e">// on_color_trans_done’s user_ctx updated in bdsp.c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .lcd_cmd_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,    <span style="color:#75715e">// DISP_CMD_BITS_WIDTH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .lcd_param_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,  <span style="color:#75715e">// DISP_PARAM_BITS_WIDTH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        },
</span></span><span style="display:flex;"><span>    .panel_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .reset_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>,  <span style="color:#75715e">// DISP_RST_PIN = GPIO21
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .rgb_ele_order <span style="color:#f92672">=</span> LCD_RGB_ELEMENT_ORDER_RGB,
</span></span><span style="display:flex;"><span>            .data_endian <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; Set the data endian for color data larger than 1 byte */</span>
</span></span><span style="display:flex;"><span>            .bits_per_pixel <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, <span style="color:#75715e">/*!&lt; Color depth, in bpp */</span>
</span></span><span style="display:flex;"><span>            .flags <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    .reset_active_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; Setting this if the panel reset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                               is high level active */</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            .vendor_config <span style="color:#f92672">=</span> NULL, <span style="color:#75715e">/*!&lt; Vendor specific configuration */</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .orientation <span style="color:#f92672">=</span> orientation_landscape,
</span></span><span style="display:flex;"><span>    .hor_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>    .ver_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><ul>
<li>st7796 i80 driver
The <code>st7796</code> driver is a display driver that is used to control the ST7796 display. The <code>st7796</code> driver configuration is part of display driver configuration.</li>
</ul>
<p>disp_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#define DISP_HOR_RES_MAX (480)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_VER_RES_MAX (320)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DISP_BUF_SIZE (DISP_HOR_RES_MAX * (DISP_VER_RES_MAX / 10))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> esp_i80_st7796_config_t st7796_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .bus_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .clk_src <span style="color:#f92672">=</span> LCD_CLK_SRC_DEFAULT,
</span></span><span style="display:flex;"><span>            .dc_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,  <span style="color:#75715e">// DISP_RS_PIN=0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .wr_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">47</span>,  <span style="color:#75715e">// DISP_WR_PIN=GPIO47
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .data_gpio_nums <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">9</span>,   <span style="color:#75715e">// DISP_D00_PIN = GPIO9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">46</span>,   <span style="color:#75715e">// DISP_D01_PIN = GPIO46
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">3</span>,   <span style="color:#75715e">// DISP_D02_PIN = GPIO3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">8</span>,  <span style="color:#75715e">// DISP_D03_PIN = GPIO8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">18</span>,   <span style="color:#75715e">// DISP_D04_PIN = GPIO18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">17</span>,  <span style="color:#75715e">// DISP_D05_PIN = GPIO17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">16</span>,   <span style="color:#75715e">// DISP_D06_PIN = GPIO16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#ae81ff">15</span>,  <span style="color:#75715e">// DISP_D07_PIN = GPIO15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// DISP_D08_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,  <span style="color:#75715e">// DISP_D09_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// DISP_D10_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,  <span style="color:#75715e">// DISP_D11_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// DISP_D12_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,  <span style="color:#75715e">// DISP_D13_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,   <span style="color:#75715e">// DISP_D14_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,  <span style="color:#75715e">// DISP_D15_PIN = N/C
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                },
</span></span><span style="display:flex;"><span>            .bus_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,  <span style="color:#75715e">// DISP_BITS_WIDTH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .max_transfer_bytes <span style="color:#f92672">=</span> DISP_BUF_SIZE <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">uint16_t</span>),
</span></span><span style="display:flex;"><span>            .psram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>,
</span></span><span style="display:flex;"><span>            .sram_trans_align <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .io_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .cs_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">48</span>, <span style="color:#75715e">//DISP_CS_PIN
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .pclk_hz <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ae81ff">1000</span>),  <span style="color:#75715e">// could be 10 if no PSRAM memory= DISP_CLK_FREQ,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .trans_queue_depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>            .dc_levels <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    .dc_idle_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    .dc_cmd_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    .dc_dummy_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    .dc_data_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            .on_color_trans_done <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                NULL,  <span style="color:#75715e">// Callback invoked when color data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                       <span style="color:#75715e">// transfer has finished updated in bdsp.c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .user_ctx <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                NULL,  <span style="color:#75715e">// User private data, passed directly to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                       <span style="color:#75715e">// on_color_trans_done’s user_ctx updated in bdsp.c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .lcd_cmd_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,    <span style="color:#75715e">// DISP_CMD_BITS_WIDTH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .lcd_param_bits <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,  <span style="color:#75715e">// DISP_PARAM_BITS_WIDTH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        },
</span></span><span style="display:flex;"><span>    .panel_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .reset_gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,  <span style="color:#75715e">// DISP_RST_PIN = GPIO4 - Same as touch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .rgb_ele_order <span style="color:#f92672">=</span> LCD_RGB_ELEMENT_ORDER_BGR,
</span></span><span style="display:flex;"><span>            .data_endian <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; Set the data endian for color data larger than 1 byte */</span>
</span></span><span style="display:flex;"><span>            .bits_per_pixel <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, <span style="color:#75715e">/*!&lt; Color depth, in bpp */</span>
</span></span><span style="display:flex;"><span>            .flags <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    .reset_active_high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; Setting this if the panel reset
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                               is high level active */</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>            .vendor_config <span style="color:#f92672">=</span> NULL, <span style="color:#75715e">/*!&lt; Vendor specific configuration */</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .orientation <span style="color:#f92672">=</span> orientation_landscape,
</span></span><span style="display:flex;"><span>    .hor_res <span style="color:#f92672">=</span> DISP_HOR_RES_MAX,
</span></span><span style="display:flex;"><span>    .ver_res <span style="color:#f92672">=</span> DISP_VER_RES_MAX,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Backlight drivers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>The <span style="color:#960050;background-color:#1e0010">`</span>disp_backlight<span style="color:#960050;background-color:#1e0010">`</span> driver is a display component that is used by the display drivers to control the backlight of the display. The <span style="color:#960050;background-color:#1e0010">`</span>disp_backlight<span style="color:#960050;background-color:#1e0010">`</span> driver configuration is part of display driver configuration.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>in disp_def.h:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">```</span>cpp
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Default backlight level value in percentage
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DISP_BCKL_DEFAULT_DUTY 100  </span><span style="color:#75715e">//%
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Backlight configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> disp_backlight_config_t disp_bcklt_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .pwm_control <span style="color:#f92672">=</span> false,   <span style="color:#75715e">// true: LEDC is used, false: GPIO is used
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .output_invert <span style="color:#f92672">=</span> false, <span style="color:#75715e">// true: LEDC output is inverted, false: LEDC output is not inverted
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .gpio_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>,         <span style="color:#75715e">// GPIO number for backlight control
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Relevant only for PWM controlled backlight
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Ignored for switch (ON/OFF) backlight control
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .timer_idx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,         <span style="color:#75715e">// LEDC timer index
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .channel_idx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>        <span style="color:#75715e">// LEDC channel index    
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};</span></span></code></pre></div><h3 id="spi-touch-drivers">SPI Touch drivers</h3>
<ul>
<li>xpt2046 driver
The <code>xpt2046</code> driver is a touch driver that is used to control the XPT2046 touch controller. The <code>xpt2046</code> driver configuration is part of the touch driver configuration.</li>
</ul>
<p>touch_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>xpt2046_config_t xpt2046_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .irq_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">36</span>,           <span style="color:#75715e">// GPIO 36
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .touch_threshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>,  <span style="color:#75715e">// Threshold for touch detection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .swap_xy <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>    .invert_x <span style="color:#f92672">=</span> false,
</span></span><span style="display:flex;"><span>    .invert_y <span style="color:#f92672">=</span> false,
</span></span><span style="display:flex;"><span>    .x_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">480</span>,
</span></span><span style="display:flex;"><span>    .y_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">320</span>,
</span></span><span style="display:flex;"><span>    .calibration_x_min <span style="color:#f92672">=</span> <span style="color:#ae81ff">140</span>,
</span></span><span style="display:flex;"><span>    .calibration_y_min <span style="color:#f92672">=</span> <span style="color:#ae81ff">290</span>,
</span></span><span style="display:flex;"><span>    .calibration_x_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">3950</span>,
</span></span><span style="display:flex;"><span>    .calibration_y_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">3890</span>,
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><h3 id="i2c-touch-drivers">I2C Touch drivers</h3>
<ul>
<li>gt911 driver
The <code>gt911</code> driver is a touch driver that is used to control the GT911 touch controller. The <code>gt911</code> driver configuration is part of the touch driver configuration file : touch_def.h.</li>
</ul>
<p>touch_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// GT911 touch controller configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> gt911_config_t gt911_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .i2c_clk_speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>    .i2c_addr <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint8_t</span>[]){<span style="color:#ae81ff">0x5D</span>, <span style="color:#ae81ff">0X14</span>,<span style="color:#ae81ff">0</span>},  <span style="color:#75715e">// Floating or mis-configured INT pin may cause GT911 to come up at address 0x14 instead of 0x5D, so check there as well.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .rst_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">38</span>, <span style="color:#75715e">// GPIO 38
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#if WITH_GT911_INT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .int_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>, <span style="color:#75715e">// GPIO 18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .int_pin <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">// INT pin not connected (by default)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .swap_xy <span style="color:#f92672">=</span> false,
</span></span><span style="display:flex;"><span>    .invert_x <span style="color:#f92672">=</span> false,
</span></span><span style="display:flex;"><span>    .invert_y <span style="color:#f92672">=</span> false,   
</span></span><span style="display:flex;"><span>    .x_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,<span style="color:#75715e">//auto detect
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .y_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,<span style="color:#75715e">//auto detect    
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};</span></span></code></pre></div><ul>
<li>ft5x06 driver
The <code>ft5x06</code> driver is a touch driver that is used to control the FT5x06 touch controller. The <code>ft5x06</code> driver configuration is part of the touch driver configuration file : touch_def.h.</li>
</ul>
<p>touch_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ft5x06_config_t ft5x06_cfg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .i2c_clk_speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span><span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>,
</span></span><span style="display:flex;"><span>    .i2c_addr <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">uint8_t</span>[]){
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0x38</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>}, 
</span></span><span style="display:flex;"><span>    .rst_pin <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">// GPIO 38
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#if WITH_FT5X06_INT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .int_pin <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>, <span style="color:#75715e">// GPIO 18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .int_pin <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">// INT pin not connected (by default)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .swap_xy <span style="color:#f92672">=</span> true,
</span></span><span style="display:flex;"><span>    .invert_x <span style="color:#f92672">=</span> false,
</span></span><span style="display:flex;"><span>    .invert_y <span style="color:#f92672">=</span> false,
</span></span><span style="display:flex;"><span>    .x_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">480</span>,
</span></span><span style="display:flex;"><span>    .y_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">800</span>,     
</span></span><span style="display:flex;"><span>};    
</span></span></code></pre></div><h3 id="camera">Camera</h3>
<p>The <code>esp3d_camera</code> driver is a camera driver that is used to control the camera. The <code>esp3d_camera</code> driver configuration is part of the camera driver configuration file : camera_def.h.</p>
<p>camera_def.h:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Camera configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> esp32_camera_config_t camera_config <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    .hw_config <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            .pin_pwdn <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,     <span style="color:#75715e">/*!&lt; GPIO pin for camera power down line */</span>
</span></span><span style="display:flex;"><span>            .pin_reset <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,    <span style="color:#75715e">/*!&lt; GPIO pin for camera reset line */</span>
</span></span><span style="display:flex;"><span>            .pin_xclk <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>,      <span style="color:#75715e">/*!&lt; GPIO pin for camera XCLK line */</span>
</span></span><span style="display:flex;"><span>            .pin_sccb_sda <span style="color:#f92672">=</span> <span style="color:#ae81ff">47</span>, <span style="color:#75715e">/*!&lt; GPIO pin for camera SDA line */</span>
</span></span><span style="display:flex;"><span>            .pin_sccb_scl <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>, <span style="color:#75715e">/*!&lt; GPIO pin for camera SCL line */</span>
</span></span><span style="display:flex;"><span>            .pin_d7 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,        <span style="color:#75715e">/*!&lt; GPIO pin for camera D7 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>,       <span style="color:#75715e">/*!&lt; GPIO pin for camera D6 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>,       <span style="color:#75715e">/*!&lt; GPIO pin for camera D5 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>,       <span style="color:#75715e">/*!&lt; GPIO pin for camera D4 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>,        <span style="color:#75715e">/*!&lt; GPIO pin for camera D3 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>,        <span style="color:#75715e">/*!&lt; GPIO pin for camera D2 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,        <span style="color:#75715e">/*!&lt; GPIO pin for camera D1 line */</span>
</span></span><span style="display:flex;"><span>            .pin_d0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>,        <span style="color:#75715e">/*!&lt; GPIO pin for camera D0 line */</span>
</span></span><span style="display:flex;"><span>            .pin_vsync <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>,     <span style="color:#75715e">/*!&lt; GPIO pin for camera VSYNC line */</span>
</span></span><span style="display:flex;"><span>            .pin_href <span style="color:#f92672">=</span> <span style="color:#ae81ff">46</span>,     <span style="color:#75715e">/*!&lt; GPIO pin for camera HREF line */</span>
</span></span><span style="display:flex;"><span>            .pin_pclk <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>,     <span style="color:#75715e">/*!&lt; GPIO pin for camera PCLK line */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            .xclk_freq_hz <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">20</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">1000</span>, <span style="color:#75715e">/*!&lt; Frequency of XCLK signal, in Hz. EXPERIMENTAL: Set to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                         16MHz on ESP32-S2 or ESP32-S3 to enable EDMA mode */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            .ledc_timer <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                LEDC_TIMER_0, <span style="color:#75715e">/*!&lt; LEDC timer to be used for generating XCLK  */</span>
</span></span><span style="display:flex;"><span>            .ledc_channel <span style="color:#f92672">=</span> LEDC_CHANNEL_0, <span style="color:#75715e">/*!&lt; LEDC channel to be used for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                               generating XCLK  */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            .pixel_format <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                PIXFORMAT_JPEG, <span style="color:#75715e">/*!&lt; Format of the pixel data: PIXFORMAT_ +
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                   YUV422|GRAYSCALE|RGB565|JPEG  */</span>
</span></span><span style="display:flex;"><span>            .frame_size <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                FRAMESIZE_VGA, <span style="color:#75715e">/*!&lt; Size of the output image: FRAMESIZE_ +
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                  QVGA|CIF|VGA|SVGA|XGA|SXGA|UXGA  */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            .jpeg_quality <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>, <span style="color:#75715e">/*!&lt; Quality of JPEG output. 0-63 lower means
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                   higher quality  */</span>
</span></span><span style="display:flex;"><span>            .fb_count <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">1</span>, <span style="color:#75715e">/*!&lt; Number of frame buffers to be allocated. If more than
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                      one, then each frame will be acquired (double speed)  */</span>
</span></span><span style="display:flex;"><span>            .fb_location <span style="color:#f92672">=</span> CAMERA_FB_IN_PSRAM, <span style="color:#75715e">/*!&lt; The location where the frame
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                                  buffer will be allocated */</span>
</span></span><span style="display:flex;"><span>            .grab_mode <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                CAMERA_GRAB_WHEN_EMPTY, <span style="color:#75715e">/*!&lt; When buffers should be filled */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if CONFIG_CAMERA_CONVERTER_ENABLED
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .conv_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; RGB&lt;-&gt;YUV Conversion mode */</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>            .sccb_i2c_port <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">/*!&lt; If pin_sccb_sda is -1, use the already
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                   configured I2C bus by number */</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    .pin_pullup_1 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">/* if any need */</span>
</span></span><span style="display:flex;"><span>    .pin_pullup_2 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">/* if any need */</span>
</span></span><span style="display:flex;"><span>    .pin_led <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    .flip_horizontaly <span style="color:#f92672">=</span> false, <span style="color:#75715e">// if horizontal flip is needed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .flip_vertically <span style="color:#f92672">=</span> false, <span style="color:#75715e">// if vertical flip is needed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .brightness <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// default value is 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .contrast <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,  <span style="color:#75715e">// default value is 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} ;</span></span></code></pre></div><h4 id="main-directory">main directory</h4>
<p>The main directory contains the main application code. The main application code is the code that is executed when the application is started. The main application code is responsible for initializing the application and starting the application tasks. The main application code is also responsible for handling the application events and updating the application state.</p>
<p>The main application code is typically organized into the following files:</p>
<ul>
<li>
<p>core directory, which contains the main application code, all common functions and  ESP3D commands.
the core directory contains the following files:</p>
<ul>
<li>commands directory that contains the ESP3D commands.</li>
<li>includes directory that contains the includes files of the core files</li>
<li>esp3d_client.cpp file that contains the internal messaging API</li>
<li>esp3d_commands.cpp file that contains the handle the ESP3D commands and also the API for the commands</li>
<li>esp3d_hal.cpp file that contains the hardware abstraction layer API for all supported hardware</li>
<li>esp3d_json_settings.cpp file that contains the API for reading setting from the JSON file like preferences.json</li>
<li>esp3d_string.h file that contains the helpers to manipulate strings and char arrays</li>
<li>esp3d_tft.cpp file that contains the core initialization of the main program</li>
<li>esp3d_values.cpp file that contains the API for storing and dispaching the values used on TFT</li>
</ul>
</li>
<li>
<p>display directory, which contain the UI code for the TFT display.
the display directory contains the following files:</p>
<ul>
<li>
<p>esp3d_tft.ui.cpp file that contains the UI code for the TFT display</p>
</li>
<li>
<p>esp3d_tft.ui.h file that contains the header code for the TFT display</p>
</li>
<li>
<p>components directory that contains the UI common components for the TFT display</p>
</li>
<li>
<p>screens directory that contains the common screens to be displayed on the TFT display</p>
</li>
<li>
<p>3dprinter directory that contains the UI code for the 3D printer TFT display
this directory contaain one directory for each targeted firmware:</p>
<ul>
<li>marlin directory that contains the UI code for the Marlin TFT display</li>
<li>repetier directory that contains the UI code for the Repetier TFT display</li>
<li>smoothieware directory that contains the UI code for the Smoothieware TFT display</li>
</ul>
<p>each target directory contain the ui code, the style to be used , the resources for each resolution and the screens to be displayed :</p>
<ul>
<li>res_320_240 directory that contains the resources for the 320x240 resolution
Each resolution directory contains the following files:
<ul>
<li>esp3d_style.h file that contains the specific style to be used on this resolution</li>
<li>logo_320_240.h file that contains the logo to be displayed on the TFT display at this resolution</li>
</ul>
</li>
<li>res_480_272 directory that contains the resources for the 480x272 resolution</li>
<li>res_480_320 directory that contains the resources for the 480x320 resolution</li>
<li>res_800_480 directory that contains the resources for the 800x480 resolution</li>
<li>screens directory that contains the specifics screens to be displayed on the TFT display</li>
<li>esp3d_style.cpp/.h files that contains the common style to be used on the TFT display</li>
<li>esp3d_tft_ui.cpp file that contains the main UI code for the TFT display</li>
</ul>
</li>
<li>
<p>cnc directory that contains the UI code for the CNC TFT display
Same as above but for the CNC firmware</p>
</li>
</ul>
</li>
<li>
<p>embedded directory, which contains the embedded resources for the ESP32.
the embedded directory contains the following files:</p>
<ul>
<li>favicon.ico.gz file that contains the favicon for the web interface</li>
<li>index.html.gz file that contains the index page for the web interface</li>
</ul>
</li>
<li>
<p>modules directory, which contains the modules code for the TFT display. each subdirectory contains the code for a specific module / feature.
the modules directory contains the following files:</p>
<ul>
<li>authentication directory that contains the code for the authentication feature</li>
<li>camera directory that contains the code for the camera feature</li>
<li>config_files directory that contains the code for the config files feature, which allow to apply settings using ini file</li>
<li>filesystem directory that contains the code for the filesystem feature: SD and flash</li>
<li>gcode_host directory that contains the code for the gcode streaming feature</li>
<li>http directory that contains the code for the http server feature, the different handlers for the web interface are splited in different subdirectories / files according usage \
<ul>
<li>authentication directory that contains the authentication handlers</li>
<li>camera directory that contains the camera handler</li>
<li>flash directory that contains the flash files management handler</li>
<li>sd directory that contains the sd files managment handler</li>
<li>ssdp directory that contains the ssdp service handler</li>
<li>update directory that contains the firmware update handler</li>
<li>webdav directory that contains the webdav protocol handler</li>
<li>ws directory that contains the websocket handler (data only not webui)</li>
<li>esp3d_commands.cpp file that handle the web commands handler</li>
<li>esp3d_config.cpp file that handle the config handler (shortcut to [ESP420])</li>
<li>esp3d_favicon.cpp file that handle the favicon handler</li>
<li>esp3d_file_not_found.cpp file that handle the file not found handler (which also handle the download of the files)</li>
<li>esp3d_root.cpp file that handle the root handler (including the maintenance mode)</li>
<li>esp3d_websocket_webui.cpp file that handle the websocket handler for the webui</li>
</ul>
</li>
<li>mdns directory that contains the code for the mdns feature</li>
<li>network directory that contains the code for the network feature</li>
<li>notifications directory that contains the code for the notifications feature</li>
<li>rendering directory that contains the code for the renderer feature (Display)</li>
<li>serial directory that contains the code for the serial communications feature</li>
<li>socket_server directory that contains the code for the socket server feature (Telnet)</li>
<li>ssdp directory that contains the code for the ssdp protocol feature</li>
<li>time directory that contains the code for the time feature (NTP)</li>
<li>translation directory that contains the code for the translation feature</li>
<li>update directory that contains the code for the update feature</li>
<li>usb_serial directory that contains the code for the usb serial feature (OTG)</li>
<li>webdav directory that contains the code for the webdav protocol feature</li>
<li>websocket directory that contains the code for the websocket feature (webui and data)</li>
</ul>
</li>
<li>
<p>target directory, which contains the target code specific actions. each subdirectory contains the code for a specific target.
the target directory contains the following files:</p>
<ul>
<li>3dprinter directory that contains the code for the 3D printer target:
<ul>
<li>marlin directory that contains the code for the Marlin target</li>
<li>repetier directory that contains the code for the Repetier target</li>
<li>smoothieware directory that contains the code for the Smoothieware target</li>
</ul>
</li>
</ul>
</li>
<li>
<p>cnc directory that contains the code for the CNC target:</p>
<ul>
<li>grbl directory that contains the code for the Grbl target</li>
</ul>
</li>
</ul>
<h4 id="scripts-directory">scripts directory</h4>
<p>The scripts directory contains the scripts used to build the firmware. The scripts directory contains the following files / directories:</p>
<ul>
<li>fonts_builder directory that contains the scripts used to build the fonts for the TFT display
the scripts will build the c code for the fonts to be used on the TFT display, the gerenated files will be placed in the fonts directory
The generated sizes are &ldquo;8&rdquo;,&ldquo;10&rdquo;,&ldquo;12&rdquo;,&ldquo;14&rdquo;,&ldquo;16&rdquo;,&ldquo;18&rdquo;,&ldquo;20&rdquo;,&ldquo;22&rdquo;,&ldquo;24&rdquo;,&ldquo;26&rdquo;,&ldquo;28&rdquo;,&ldquo;30&rdquo;,&ldquo;32&rdquo;,&ldquo;34&rdquo;,&ldquo;36&rdquo;,&ldquo;38&rdquo;,&ldquo;40&rdquo;,&ldquo;42&rdquo;,&ldquo;44&rdquo;,&ldquo;46&rdquo;,&ldquo;48&rdquo; pixels.
<ul>
<li>It use Montserrat-Medium.ttf as base font:</li>
</ul>
<ul>
<li>Generic chars are from 0x20 to 0x7F and with 0xB0.</li>
<li>French chars are 0xE0,0xE7,0xE8,0xE9,0xEA,0xF4</li>
</ul>
<ul>
<li>I use also FreeSerifBold.ttf  0x2022 char</li>
<li>for the symbols I use Font fa-solid-900 and fa-brands-400.ttf:
<table>
<thead>
<tr>
<th>code</th>
<th>SYMBOL</th>
<th>font</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xe568</td>
<td>HEAT_BED</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf2c9</td>
<td>EXTRUDER</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf0ca</td>
<td>LIST</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf715</td>
<td>SLASH</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf012</td>
<td>STATION_MODE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf519</td>
<td>ACCESS_POINT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf00c</td>
<td>OK</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xe596</td>
<td>PROBE_CHECK</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf00d</td>
<td>CLOSE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf011</td>
<td>POWER</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf028</td>
<td>VOLUME_HIGH</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf027</td>
<td>VOLUME_LOW</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf6a9</td>
<td>VOLUME_OFF</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf013</td>
<td>SETTINGS</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf2d1</td>
<td>NO_HEAT_BED</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xe040</td>
<td>HEAT_EXTRUDER</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf2ed</td>
<td>TRASH</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xe3af</td>
<td>HOME</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf019</td>
<td>DOWNLOAD</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf021</td>
<td>REFRESH</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf304</td>
<td>EDIT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf048</td>
<td>PREVIOUS</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf051</td>
<td>NEXT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf04b</td>
<td>PLAY</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf04c</td>
<td>PAUSE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf0c7</td>
<td>SAVE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf0e0</td>
<td>MESSAGE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf0e7</td>
<td>LASER</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf76f</td>
<td>VACCUM</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf1f6</td>
<td>DISABLE_ALERT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf023</td>
<td>LOCK</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf2dc</td>
<td>COOLANT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf04d</td>
<td>STOP</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf1eb</td>
<td>WIFI</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf071</td>
<td>WARNING</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf07b</td>
<td>FOLDER</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf15b</td>
<td>FILE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf11c</td>
<td>KEYBOARD</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf55a</td>
<td>BACKSPACE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf7c2</td>
<td>SD_CARD</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf0b2</td>
<td>JOG</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf077</td>
<td>UP</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf078</td>
<td>DOWN</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf053</td>
<td>LEFT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf054</td>
<td>RIGHT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf120</td>
<td>COMMAND</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf624</td>
<td>GAUGE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf1ab</td>
<td>LANGUAGE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf863</td>
<td>FAN</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf48b</td>
<td>SPEED</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf72b</td>
<td>WIZARD</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf185</td>
<td>LIGHT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf5c1</td>
<td>ENGINE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf5fd</td>
<td>LAYERS</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xe4b8</td>
<td>LEVELING</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf4db</td>
<td>FILAMENT</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xe4bd</td>
<td>CENTER</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf002</td>
<td>SEARCH</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf4d7</td>
<td>FILAMENT_SENSOR</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf2cc</td>
<td>MIST</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf13e</td>
<td>UNLOCK</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf192</td>
<td>LASER_2</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xe4c3</td>
<td>MILLING</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf3e5</td>
<td>NEW_LINE</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf293</td>
<td>BLUETOOTH</td>
<td>fa-brands-400.ttf</td>
</tr>
<tr>
<td>0xf287</td>
<td>USB</td>
<td>fa-brands-400.ttf</td>
</tr>
<tr>
<td>0xf0a1</td>
<td>MORE_INFO</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf055</td>
<td>PLUS</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf056</td>
<td>MINUS</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf256</td>
<td>MANUAL</td>
<td>fa-solid-900.ttf</td>
</tr>
<tr>
<td>0xf544</td>
<td>AUTOMATIC</td>
<td>fa-solid-900.ttf</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
</ul>
<p><a href="#R-image-8df2ef60e99e4c0344c900f80e57d014" class="lightbox-link"><img class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="/esp3d-tft/v1.x/documentation/api/project-arch/symbols_1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8df2ef60e99e4c0344c900f80e57d014"><img class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="/esp3d-tft/v1.x/documentation/api/project-arch/symbols_1.png"></a> <br>
<a href="#R-image-3bb5992cd5c69f5defcfccb47971b370" class="lightbox-link"><img class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="/esp3d-tft/v1.x/documentation/api/project-arch/symbols_2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3bb5992cd5c69f5defcfccb47971b370"><img class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="/esp3d-tft/v1.x/documentation/api/project-arch/symbols_2.png"></a></p>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <article class="chapter">
<h1 id="web-handlers">Web Handlers</h1>
<h3 id="-get">/ (GET)</h3>
<p>root is the default handler where all files will be served, if no file is defined, it looks for index.html or index.html.gz (compressed)
if you call specific file, it will look for the filename and filename.gz (compressed)
if no file is defined and there is not index.html(.gz) it will display embedded page
another way to show the embedded page is /?forcefallback=yes</p>
<h3 id="sd-get">/sd/ (GET)</h3>
<p>it will serve any file from SD card if there is one, it is only a wrapper to read SD card, no upload</p>
<h3 id="files-getpost">/files (GET/POST)</h3>
<p>this handler handle all commands for FS, including upload on FS.<br>
possible options/arguments are:</p>
<ul>
<li><code>quiet=yes</code> can be used when you don&rsquo;t want list files but just upload them</li>
<li><code>path=...</code> define the path to the file</li>
<li><code>action=...</code> define the action to execute which can be:<br>
- delete<br>
delete the file defined by <code>filename=...</code> it will also use <code>path=...</code> to do full path<br>
- deletedir<br>
delete the directory defined by <code>filename=...</code> it will also use <code>path=...</code> to do full path <br>
- createdir
create the directory defined by <code>filename=...</code> it will also use <code>path=...</code> to do full path</li>
<li><code>createPath=yes</code> when doing upload and the path do not exists, it will create it, POST only</li>
<li><code>&lt;filename&gt;S=...</code> give the size of uploaded file with <!-- raw HTML omitted --> name, need to be set before file is set in upload, POST only</li>
</ul>
<p>the output is a json file:</p>
<pre><code>```json
{   
    &quot;files&quot;:[ //the files list  
        {  
            &quot;name&quot;:&quot;index.html.gz&quot;, //the name of the file
            &quot;size&quot;:&quot;83.46 KB&quot;, //the formated size of the file 
            &quot;time&quot;:&quot;2022-09-04 11:56:05&quot; //the time when the file was modified last time, this one is optional and depend on (FILESYSTEM_TIMESTAMP_FEATURE)
        },
        {
            &quot;name&quot;:&quot;subdir&quot;, //the name of the file / directory
            &quot;size&quot;:&quot;-1&quot;, //the size is -1 because it is a directory
            &quot;time&quot;:&quot;&quot; //no time for directories optional as depend on (FILESYSTEM_TIMESTAMP_FEATURE)
        }
    ],
    &quot;path&quot;:&quot;/&quot;, //current path
    &quot;occupation&quot;:&quot;52&quot;, //% of occupation
    &quot;status&quot;:&quot;subdir created&quot;, //status 
    &quot;total&quot;:&quot;192.00 KB&quot;, //Formated total space of Filesystem
    &quot;used&quot;:&quot;100.00 KB&quot; //Formated used space of Filesystem
}
```
</code></pre>
<h3 id="sdfiles-getpost-">/sdfiles (GET/POST) )</h3>
<p>this handler handle all commands for SD, including upload on SD (only shared and direct SD)
this handler handle all commands for FS, including upload on FS.<br>
possible options/arguments are:</p>
<ul>
<li><code>quiet=yes</code> can be used when you don&rsquo;t want list files but just upload them</li>
<li><code>path=...</code> define the path to the file</li>
<li><code>action=...</code> define the action to execute which can be:<br>
- list
Will refresh the stats of the files
- delete<br>
delete the file defined by <code>filename=...</code> it will also use <code>path=...</code> to do full path<br>
- deletedir<br>
delete the directory defined by <code>filename=...</code> it will also use <code>path=...</code> to do full path <br>
- createdir
create the directory defined by <code>filename=...</code> it will also use <code>path=...</code> to do full path</li>
<li><code>createPath=yes</code> when doing upload and the path do not exists, it will create it, POST only</li>
<li><code>&lt;filename&gt;S=...</code> give the size of uploaded file with <!-- raw HTML omitted --> name, need to be set before file is set in upload, POST only</li>
</ul>
<p>the output is a json file:</p>
<pre><code>```json
{
    &quot;files&quot;:[ //the files list
        {
            &quot;name&quot;:&quot;3Oc-pika2.gco&quot;,//the name of the file
            &quot;shortname&quot;:&quot;3Oc-pika2.gco&quot;, //the 8.3 shortname if available, if not the name of the file
            &quot;size&quot;:&quot;83.46 KB&quot;, //the formated size of the file 
            &quot;time&quot;:&quot;2022-09-04 11:56:05&quot; //the time when the file was modified last time, this one is optional and depend on (SD_TIMESTAMP_FEATURE)
        },
        {
            &quot;name&quot;:&quot;subdir&quot;, //the name of the file / directory
            &quot;size&quot;:&quot;-1&quot;, //the size is -1 because it is a directory
            &quot;time&quot;:&quot;&quot; //no time for directories optional as depend on (SD_TIMESTAMP_FEATURE)
        }
    ],
    &quot;path&quot;:&quot;/&quot;, //current path
    &quot;occupation&quot;:&quot;52&quot;, //% of occupation
    &quot;status&quot;:&quot;subdir created&quot;, //status 
    &quot;total&quot;:&quot;192.00 KB&quot;, //Formated total space of Filesystem
    &quot;used&quot;:&quot;100.00 KB&quot; //Formated used space of Filesystem
}
```
</code></pre>
<h3 id="upload-post">/upload (POST)</h3>
<p>this handler is for MKS boards using MKS communication protocol if enabled, it handle only upload on SD</p>
<h3 id="command-get">/command (GET)</h3>
<p>this handler is for all commands the parameter is <code>cmd=...</code>
if it is an <code>[ESPXXX]</code> command the answer is the <code>[ESPXXX]</code> response
if it is not an <code>[ESPXXX]</code> command the answer is <code>ESP3D says: command forwarded</code> and can be ignored</p>
<h3 id="login-getpost">/login (GET/POST)</h3>
<p>this handler is for authentication function if enabled
possible options/arguments are:<br>
- <code>DISCONNECT=YES</code>
it will clear current session, remove authentication cookie, set status to <code>disconnected</code> and response code to 401
- <code>SUBMIT=YES</code>
to login it will need also <code>PASSWORD=...</code> and <code>USER=...</code>, the answer will be 200 if success and 401 if failed
if user is already authenticated it can use <code>NEWPASSWORD=...</code> instead of <code>PASSWORD=...</code> to change his password, if successful answer will be returned with code 200, otherwise code will be 500 if change failed or if password format is invalid</p>
<p>Output:</p>
<ul>
<li>if authentified and no submission:<br>
<code>{&quot;status&quot;:&quot;Identified&quot;,&quot;authentication_lvl&quot;:&quot;admin&quot;}</code> and code 200</li>
<li>if not authenticated and no submission:<br>
<code>{&quot;status&quot;:&quot;Wrong authentication!&quot;,&quot;authentication_lvl&quot;:&quot;guest&quot;}</code> and code 401</li>
</ul>
<h3 id="config-get">/config (GET)</h3>
<p>this handler is a shortcut to [ESP420] command in text mode, to get output in json add <code>json=yes</code></p>
<h3 id="updatefw-getpost">/updatefw (GET/POST)</h3>
<p>this handler is for FW upload and update
Answer output is :
<code>{&quot;status&quot;:&quot;...&quot;}</code> if upload is successful the ESP will restart</p>
<h3 id="snap-get">/snap (GET)</h3>
<p>this handler is on esp32cam with camera enabled to capture a Frame
it answer by sending a jpg image</p>
<h3 id="descriptionxml-get">/description.xml (GET)</h3>
<p>this handler is for SSDP if enabled to present device informations</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;root</span> <span style="color:#960050;background-color:#1e0010">xmlns=</span><span style="color:#e6db74">&#34;urn:schemas-upnp-org:device-1-0&#34;</span><span style="color:#960050;background-color:#1e0010">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">&lt;specVersion&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;major&gt;</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&lt;/major&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;minor&gt;</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&lt;/minor&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">&lt;/specVersion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">&lt;URLBase&gt;http:</span><span style="color:#75715e">//192.168.2.178:80/&lt;/URLBase&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">&lt;device&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;deviceType&gt;urn:schemas-upnp-org:device:upnp:rootdevice:</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&lt;/deviceType&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;friendlyName&gt;esp</span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">d&lt;/friendlyName&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;presentationURL&gt;/&lt;/presentationURL&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;serialNumber&gt;</span><span style="color:#ae81ff">52332</span><span style="color:#960050;background-color:#1e0010">&lt;/serialNumber&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;modelName&gt;ESP</span> <span style="color:#960050;background-color:#1e0010">Board&lt;/modelName&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;modelDescription/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;modelNumber&gt;ESP</span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">D</span> <span style="color:#ae81ff">3.0</span><span style="color:#960050;background-color:#1e0010">&lt;/modelNumber&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;modelURL&gt;https:</span><span style="color:#75715e">//www.espressif.com/en/products/devkits&lt;/modelURL&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#960050;background-color:#1e0010">&lt;manufacturer&gt;Espressif</span> <span style="color:#960050;background-color:#1e0010">Systems&lt;/manufacturer&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;manufacturerURL&gt;https:</span><span style="color:#75715e">//www.espressif.com&lt;/manufacturerURL&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#960050;background-color:#1e0010">&lt;UDN&gt;uuid:</span><span style="color:#ae81ff">38323636-4558-4</span><span style="color:#960050;background-color:#1e0010">dda</span><span style="color:#ae81ff">-9188</span><span style="color:#960050;background-color:#1e0010">-cda</span><span style="color:#ae81ff">0e600</span><span style="color:#960050;background-color:#1e0010">cc</span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">c&lt;/UDN&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;serviceList/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">&lt;iconList/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">&lt;/device&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;/root&gt;</span></span></span></code></pre></div><h3 id="captive-portal-bypass-handlers">Captive portal bypass handlers</h3>
<p>to avoid a redirect to index.html and so a refresh of the page, some classic handler have been added so they all go to / handler actually</p>
<ul>
<li>/generate_204</li>
<li>/gconnectivitycheck.gstatic.com</li>
<li>/fwlink/</li>
</ul>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <article class="chapter">
<h1 id="clients">Clients</h1>
<h3 id="flow">Flow</h3>

<pre class="mermaid align-center zoomable">
%%{init:{&#34;theme&#34;:&#34;default&#34;}}%%
graph LR;
    A[Serial]
    B[USB]
    C[GCode Parser]
    D[Stream]
    E[Command]
    F[System]
    G[Telnet]
    H[WebUI]
    I[WebUI WebSocket]
    K[WebSocket]
    M[SD Card]
    D--&gt;|S|B
    D--&gt;|S|A
    H--&gt;|S|D
    G--&gt;|S|D
    K--&gt;|S|D
    M--&gt;|S|D
    E--&gt;|R|I
    F--&gt;|R|I
    A--&gt;|R|C
    B--&gt;|R|C
    E--&gt;|R|K
    E--&gt;|R|G
    E--&gt;|R|K
    E--&gt;|R|G
    
    F--&gt;|R|K
    F--&gt;|R|G
    F--&gt;|R|K
    F--&gt;|R|G
    C--&gt;|R|D
    C--&gt;|R|G
    C--&gt;|R|I
    C--&gt;|R|K
</pre>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <article class="chapter">
<h1 id="web-sockets">Web Sockets</h1>
<p>there are 2</p>
<ul>
<li>
<p>terminal websocket
used to stream data to webUI and exchange internal data</p>
</li>
<li>
<p>data websocket
used to exchange data with external client (not used by WebUI)</p>
</li>
</ul>
<h2 id="terminal-websocket">Terminal websocket</h2>
<p>use subprotocol <code>webui-v3</code> and port is same as web port but use address <code>/ws</code></p>
<h3 id="utext-modeu"><!-- raw HTML omitted -->text mode<!-- raw HTML omitted --></h3>
<p>Reserved
messages between webui / ESP
Format: <code>&lt;label&gt;:&lt;message&gt;</code></p>
<ul>
<li>
<p>from ESP to WebUI</p>
<ul>
<li>
<p><code>currentID:&lt;id&gt;</code>
Sent when client is connecting, it is the last ID used and become the active ID</p>
</li>
<li>
<p><code>activeID:&lt;id&gt;</code>
Broadcast current active ID, when new client is connecting, client without this is <!-- raw HTML omitted --> should close, ESP WS Server close all open WS connections but this one also</p>
</li>
<li>
<p><code>PING:&lt;time left&gt;:&lt;time out&gt;</code>
It is a response to PING from client to inform the time left if no activity (see below)</p>
</li>
<li>
<p><code>ERROR:&lt;code&gt;:&lt;message&gt;</code>
If an error raise when doing upload, it informs client it must stop uploading because sometimes the http answer is not possible,
or cannot cancel the upload, this is a workaround as there is no API in current webserver to cancel active upload</p>
</li>
<li>
<p><code>NOTIFICATION:&lt;message&gt;</code>
Forward the message sent by [ESP600] to webUI toast system</p>
</li>
<li>
<p><code>SENSOR: &lt;value&gt;[&lt;unit&gt;] &lt;value2&gt;[&lt;unit2&gt;] ...</code>
The sensor connected to ESP like DHT22</p>
</li>
</ul>
</li>
<li>
<p>from WebUI to ESP</p>
<ul>
<li><code>PING:&lt;current cookiesessionID / none &gt;</code> if any, or &ldquo;none&rdquo; if none</li>
</ul>
</li>
</ul>
<h3 id="ubinary-modeu"><!-- raw HTML omitted -->binary mode<!-- raw HTML omitted --></h3>
<p>Reserved</p>
<ul>
<li>
<p>from ESP to WebUI
stream data from ESP to WebUI</p>
</li>
<li>
<p>from WEBUI to ESP<br>
[-&gt; File transfert from WebUI to ESP : not implemented yet]</p>
</li>
</ul>
<h2 id="data-websocket">Data websocket</h2>
<p>use sub protocol <code>arduino</code> and port same as web port but use address <code>/wsdata</code></p>
<h3 id="utext-modeu-1"><!-- raw HTML omitted -->text mode<!-- raw HTML omitted --></h3>
<p>This mode is used to transfert all GCODE commands and their answers from printer/cnc</p>
<h3 id="ubinary-modeu-1"><!-- raw HTML omitted -->binary mode<!-- raw HTML omitted --></h3>
<p>This mode is used to transfert files to / from esp board</p>
<p>it use frame of 1024 bytes, can be increased after test</p>
<p>the frame format is :
2 bytes: for frame type
2 bytes: for frame size to check some integrity, currently as already part of frame no checksume is used
x bytes : extra data according frame type</p>
<h2 id="frame-types">Frame types</h2>
<h3 id="query-status-frame">Query status frame</h3>
<p>type: client -&gt; esp
Status Request</p>
<table>
<thead>
<tr>
<th><code>S</code></th>
<th><code>R</code></th>
<th>0</th>
<th>0</th>
</tr>
</thead>
</table>
<p>with hexadecimal values:</p>
<table>
<thead>
<tr>
<th>0x53</th>
<th>0x52</th>
<th>0</th>
<th>0</th>
</tr>
</thead>
</table>
<p>Response frame use inverted header:
Response Status</p>
<table>
<thead>
<tr>
<th><code>R</code></th>
<th><code>S</code></th>
<th>0</th>
<th>1</th>
<th><code>A</code></th>
</tr>
</thead>
</table>
<p>with hexadecimal values:</p>
<table>
<thead>
<tr>
<th>0x52</th>
<th>0x53</th>
<th>0</th>
<th>1</th>
<th>0x41</th>
</tr>
</thead>
</table>
<p>the first byte of answer is the state</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Hexa</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>B</code></td>
<td>0x42</td>
<td>busy</td>
</tr>
<tr>
<td><code>O</code></td>
<td>0x4F</td>
<td>idle/ok</td>
</tr>
<tr>
<td><code>E</code></td>
<td>0x45</td>
<td>error</td>
</tr>
<tr>
<td><code>A</code></td>
<td>0x41</td>
<td>abort</td>
</tr>
<tr>
<td><code>D</code></td>
<td>0x44</td>
<td>download ongoing</td>
</tr>
<tr>
<td><code>U</code></td>
<td>0x55</td>
<td>upload ongoing</td>
</tr>
</tbody>
</table>
<p>extra data may be added :</p>
<h4 id="for-error">For Error:</h4>
<p>error code and string,
1 byte : error code: 0-&gt;255
1 byte : string size 0-&gt;255
XX bytes for the string</p>
<table>
<thead>
<tr>
<th><code>R</code></th>
<th><code>S</code></th>
<th>x</th>
<th>x</th>
<th><code>C</code></th>
<th>4</th>
<th>X</th>
<th>..</th>
<th>..</th>
</tr>
</thead>
</table>
<h4 id="for-upload">For Upload:</h4>
<p>Upload informations:
1 byte : path size 0-&gt;255
XX bytes : the path string
1 byte : the filename size 0-&gt;255
xx bytes : filename string
4 bytes : total file size
4 bytes : currently processed bytes
4 bytes : last packet id processed</p>
<table>
<thead>
<tr>
<th><code>R</code></th>
<th><code>S</code></th>
<th>x</th>
<th>x</th>
<th><code>U</code></th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
<th>S2</th>
<th>S2</th>
<th>S2</th>
<th>S2</th>
</tr>
</thead>
</table>
<h4 id="for-download">For Download:</h4>
<p>Download informations:
1 byte : path size 0-&gt;255
XX bytes : the path string
1 byte : the filename size 0-&gt;255
xx bytes : filename string
4 bytes : total file size
4 bytes : currently processed bytes
4 bytes : last packet id processed</p>
<table>
<thead>
<tr>
<th><code>R</code></th>
<th><code>S</code></th>
<th>x</th>
<th>x</th>
<th><code>D</code></th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
<th>S2</th>
<th>S2</th>
<th>S2</th>
<th>S2</th>
</tr>
</thead>
</table>
<h3 id="start-upload-frame">Start upload frame</h3>
<p>header is :</p>
<table>
<thead>
<tr>
<th><code>S</code></th>
<th><code>U</code></th>
<th>0</th>
<th>0</th>
</tr>
</thead>
</table>
<p>the content is:
1 byte : path size 0-&gt;255
XX bytes : the path string
1 byte : the filename size 0-&gt;255
xx bytes : filename string
4 bytes : total file size</p>
<table>
<thead>
<tr>
<th><code>S</code></th>
<th><code>U</code></th>
<th>x</th>
<th>x</th>
<th><code>D</code></th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
</tr>
</thead>
</table>
<p>if answer is :</p>
<table>
<thead>
<tr>
<th><code>U</code></th>
<th><code>S</code></th>
<th>0</th>
<th>1</th>
<th><code>O</code></th>
</tr>
</thead>
</table>
<p>it means transfert can start</p>
<h3 id="transfert-upload-frame">Transfert upload frame</h3>
<p>header is :</p>
<table>
<thead>
<tr>
<th><code>U</code></th>
<th><code>P</code></th>
<th>x</th>
<th>x</th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
<th>..</th>
<th>..</th>
</tr>
</thead>
</table>
<p>4 bytes is packet id
XXXX bytes is data</p>
<p>if packet is received the answer is</p>
<table>
<thead>
<tr>
<th><code>P</code></th>
<th><code>U</code></th>
<th>0</th>
<th>5</th>
<th><code>O</code></th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
</tr>
</thead>
</table>
<h3 id="start-dowload-frame">Start dowload frame</h3>
<p>header is :</p>
<table>
<thead>
<tr>
<th><code>S</code></th>
<th><code>D</code></th>
<th>0</th>
<th>0</th>
</tr>
</thead>
</table>
<p>the content is:
1 byte : path size 0-&gt;255
XX bytes : the path string
1 byte : the filename size 0-&gt;255
xx bytes : filename string
4 bytes : total file size</p>
<table>
<thead>
<tr>
<th><code>S</code></th>
<th><code>D</code></th>
<th>x</th>
<th>x</th>
<th><code>D</code></th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>X</th>
<th>..</th>
<th>..</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
<th>S1</th>
</tr>
</thead>
</table>
<p>if answer is :</p>
<table>
<thead>
<tr>
<th><code>D</code></th>
<th><code>S</code></th>
<th>0</th>
<th>1</th>
<th><code>O</code></th>
</tr>
</thead>
</table>
<p>it means transfert can start</p>
<h3 id="transfert-download-frame">Transfert download frame</h3>
<p>header is :</p>
<table>
<thead>
<tr>
<th><code>D</code></th>
<th><code>P</code></th>
<th>x</th>
<th>x</th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
<th>..</th>
<th>..</th>
</tr>
</thead>
</table>
<p>4 bytes is packet id
XXXX bytes is data</p>
<p>if packet is received the answer is</p>
<table>
<thead>
<tr>
<th><code>P</code></th>
<th><code>D</code></th>
<th>0</th>
<th>5</th>
<th><code>O</code></th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
<th>ID</th>
</tr>
</thead>
</table>
<h3 id="command-frame">Command frame</h3>
<p>header is :</p>
<table>
<thead>
<tr>
<th><code>C</code></th>
<th><code>M</code></th>
<th>0</th>
<th>1</th>
<th>X</th>
</tr>
</thead>
</table>
<p>Commands:</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Hexa</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A</code></td>
<td>0x41</td>
<td>abort</td>
</tr>
</tbody>
</table>
<p>Abort command frame</p>
<table>
<thead>
<tr>
<th><code>C</code></th>
<th><code>M</code></th>
<th>0</th>
<th>1</th>
<th><code>A</code></th>
</tr>
</thead>
</table>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <article class="chapter">
<h1 id="syntax-conventions">Syntax conventions</h1>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>This document is a receipe of conventions that may not be currently implemented yet, but will be from now, current code will be updated according to it before beta state.</p>
</div>
</div>
<p>Style should be also applied also</p>
<h2 id="c">C++</h2>
<h3 id="style">Style</h3>
<ul>
<li>Use Clang-format
<ul>
<li>Download the tool according your system <br>
<a href="https://releases.llvm.org/" rel="external" target="_blank">https://releases.llvm.org/</a></li>
<li>Install client extension  <br>
CLang-Format from Xaver Hellauer</li>
<li>Define the style <br>
set <code>Google</code> as default style</li>
</ul>
</li>
</ul>
<h3 id="general">General</h3>
<ul>
<li>Avoid abreviation as much as possible</li>
<li>Avoid unnecessary long name</li>
<li>ESP3D is always uppercase in code, esp3d is valid only for filename, any mixing case is proscribed (e.g.:<code>Esp3D</code>/<code>esp3D</code>/<code>Esp3d</code>)</li>
<li>ESP command is always uppercase, so any reference to it (e.g.: <code>ESP100</code>) should be uppercase to avoid confusion, only filename can be lowercase, any  mixing case is proscribed</li>
</ul>
<h3 id="file-name">File name</h3>
<ul>
<li>Use lower case for file names</li>
<li>Use underscores as words separators<br>
e.g: <code>esp3d_settings.cpp</code></li>
</ul>
<h3 id="directory-name">Directory name</h3>
<ul>
<li>Use lower case for directory names</li>
<li>Use underscores as words separators<br>
e.g: <code>esp3d_commansds</code></li>
<li>Target directories are the only names that use full uppercase unlike others directories<br>
e.g: <code>ESP32S3_ZX3D50CE02S_USRC_4832</code></li>
</ul>
<h3 id="variable">Variable</h3>
<ul>
<li>Any name should begin with an alphabet.</li>
<li>The first character should be lowercase.</li>
<li>Use upper case letters as words separators</li>
<li>Digits may be used in the name but only after the alphabet.</li>
<li>No special symbols can be used in names.</li>
<li>No keywords can be used as names.</li>
<li>Pointer variables should be prepended with ‘p’ and place the asterisk ‘*’ close to the name instead of the pointer type.</li>
<li>Static variables should be prepended with ‘s’.</li>
<li>always initialize the variable<br>
e.g:<br>
<code>char adminPassword[20]{0};</code><br>
<code>char *pAdminLogin = nullptr;</code></li>
</ul>
<h3 id="constant">Constant</h3>
<ul>
<li>Any name should begin with an alphabet.</li>
<li>The first character should be <code>k</code>.</li>
<li>Use upper case letters as words separators</li>
<li>Digits may be used in the name but only after the alphabet.</li>
<li>No special symbols can be used in names.</li>
<li>No keywords can be used as names.<br>
e.g: <code>const int kTopLimit 100;</code></li>
</ul>
<h3 id="define">Define</h3>
<p>Define use uppercase letters only and underscores as words separators, dash is not allowed. <br>
e.g: <code>#define LOWER_LIMIT 10;</code></p>
<h3 id="enum">Enum</h3>
<ul>
<li>Enum should use <code>enum class</code> not plain <code>enum</code> neither <code>enum struct</code></li>
<li>If enum is used by several file, enum should be defined in separate file to avoid repeated definitions, and add <code>_type</code> suffix to file name</li>
<li>The first character in the enum name must be in upper case.</li>
<li>Use upper case letters as word separators.</li>
<li>No underscores (‘_’) are permitted in the enum name.</li>
<li>Enum values are lower case and use underscores as words separators.</li>
<li>No need to <code>typedef</code> enum</li>
<li>Use type as much as possible to clarify any casting if necessary</li>
<li>Define enum values as much as possible to ensure consistency when doing update</li>
<li>Do not use <code>#ifdef</code> in enum unless all enum values are explicitly defined</li>
</ul>
<p>e.g: <code>esp3d_gcode_host_type.h</code></p>
<ul>
<li>not explicitly defined</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>enum class Esp3dGcodeHostWait : uint8_t {
    no_wait = 0,
    wait_ack,
    wait_busy,
    wait_processing,
    wait_heating
};</code></pre></div><p>Usage example: <code>Esp3dGcodeHostWait::no_wait</code></p>
<ul>
<li>explicitly defined</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>enum class Status: char
{
    high = &#39;h&#39;,
    low = &#39;l&#39;
}; </code></pre></div><p>Usage example: <code>Status::low</code></p>
<h3 id="structunion">Struct/Union</h3>
<ul>
<li>If struct/union is used by several file, struct should be defined in separate file to avoid repeated definitions, and add <code>_type</code> suffix to file name</li>
<li>The first character in the struct name must be in upper case.</li>
<li>Use upper case letters as word separators</li>
<li>Struct values are lower case and use underscores as words separators if variables.</li>
<li>No need to <code>typedef</code> for struct</li>
<li>As we use C++20, initialize struct explicitly</li>
</ul>
<p>e.g: <code>setting_description_type.h</code></p>
<div class="highlight wrap-code"><pre tabindex="0"><code>struct  SettingDescription{
    uint16_t size = 0;
    const char* defaultVal = nullptr;
} ;</code></pre></div><p>usage example: <code>SettingDescription notificationSetting;</code></p>
<h3 id="class">Class</h3>
<ul>
<li>The class name should be a noun.</li>
<li>Use upper case letters as word separators, and lower case for the rest of the word in the class name.</li>
<li>The first character in the class name must be in upper case.</li>
<li>No underscores (‘_’) are permitted in the class name.</li>
<li>The private and protected attribute name in class should be prepended with the character underscore (‘_’).</li>
<li>Each method/ function name should begin with a verb.</li>
<li>The first character of function/ method argument names should be lowercase.</li>
<li>Use upper case letter as word separator</li>
<li>Any name should begin with an alphabet.</li>
<li>Digits may be used in the name but only after the alphabet.</li>
<li>No special symbols can be used in names except for the underscore(‘_’).</li>
<li>No keywords can be used as names.</li>
<li>Pointer variables should be prepended with ‘p’ and place the asterisk ‘*’ close to the name instead of the pointer type.</li>
<li>Static variables should be prepended with ‘s’.</li>
<li>Getter should use same name as attribute name.</li>
<li>Setter should use same name as attribute name with <code>set</code> prefix and upper case the first letter of name.</li>
</ul>
<p>e.g:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>class Esp3dAuthenticationService {
public:
    bool begin();
    bool isAdmin (const char *pwd);
    char * getPassword ();
private:
    std::string _adminPwd;
    char *_pName;
    static char _sLogin; 
}</code></pre></div><h3 id="functionprocedure">Function/Procedure</h3>
<ul>
<li>Each Function/Procedure name should begin with a verb.</li>
<li>The first character of argument names should be lowercase.</li>
<li>Use upper case letter as word separator</li>
<li>Any name should begin with an alphabet.</li>
<li>Digits may be used in the name but only after the alphabet.</li>
<li>No special symbols can be used in names except for the underscore(‘_’).</li>
<li>No keywords can be used as names.</li>
</ul>
<h3 id="namespace">Namespace</h3>
<ul>
<li>Namespace names are all lower-case, with words separated by underscores.</li>
<li>Do not use <code>using</code> but full namespace instead for clarity<br>
e.g:</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>namespace esp3d_hal{
    int64_t millis();
}</code></pre></div><p>usage example: <code>esp3d_hal::millis();</code></p>
<h3 id="typedef">typedef</h3>
<ul>
<li>If variable
<ul>
<li>Use lower case for names</li>
<li>Use underscores as words separators</li>
<li>Add suffix <code>_t</code>
e.g: <code>typedef int setting_index_t</code></li>
</ul>
</li>
<li>If function
<ul>
<li>Follow function naming syntax</li>
<li>Add suffix <code>_t</code>
e.g: <code>typedef std::function&lt;bool(const char*, const char*,const char*)&gt; processingFunction_t;</code></li>
</ul>
</li>
</ul>
<h3 id="0-and-nullptrnull">0 and nullptr/NULL</h3>
<p>Use nullptr for pointers, and &lsquo;\0&rsquo; for chars (and not the 0 literal).</p>
<p>For pointers (address values), use nullptr, as this provides type-safety.</p>
<p>Use &lsquo;\0&rsquo; for the null character. Using the correct type makes the code more readable.</p>
<h3 id="sizeof">sizeof</h3>
<p>Prefer sizeof(varname) to sizeof(type). sizeof(varname) will update appropriately if someone changes the variable type either now or later.</p>
<h3 id="auto-type"><code>auto</code> type</h3>
<p>Only use auto type if no need to to do type deduction, C++ code is usually clearer when types are explicit, especially when type deduction would depend on information from distant parts of the code.</p>
<h3 id="casting">Casting</h3>
<ul>
<li>Use C++-style casts<br>
e.g: <code>static_cast&lt;float&gt;(double_value)</code></li>
<li>Do not use C cast unless the cast is to void<br>
e.g: <code>(int)3.5;</code></li>
</ul>
<h3 id="initialization">Initialization</h3>
<ul>
<li>Do not mix brace initialization and <code>=</code> for readibility</li>
</ul>
<h3 id="lambda-expressions">Lambda Expressions</h3>
<p>//TODO</p>
<p>Inspired from :</p>
<ul>
<li><a href="https://www.geeksforgeeks.org/naming-convention-in-c/" rel="external" target="_blank">Naming Convention in C++</a></li>
<li><a href="https://google.github.io/styleguide/cppguide.html" rel="external" target="_blank">Google C++ Style Guide</a></li>
</ul>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <article class="chapter">
<h1 id="gcode-streaming-api">GCode streaming API</h1>
<h2 id="clients">Clients</h2>
<p>The Gcode Stream Client is the actual streaming service, it is the only one that send msg to output client. On another way the GcodeStreamClient is only one of the active clients which will get the msg from the output client.
The GcodeStreamClient use the GCodeParser to parse in/out commands and handle messages correctly.</p>
<h2 id="components">Components</h2>
<p>1 - Streaming Types
There are several types of streaming services:<br>
A - Unknown<br>
The type is not yet defined, this type cannot be streamed until it is identified.</p>
<pre><code>B - Single Command
This is for any normal GCODE or ESPXXX command coming from any client, this type cannot be interrupted once started, ESP700 / ESP701 do not support it. This type will be added to the script queue and processed FIFO. 

C - Multiple Commands
This is used by scripts stored in EEPROM (resume/pause/abort), this type cannot be interrupted, and all commands will be executed one after another until the end, ESP700 / ESP701 do not support it. This type will be added to the script queue and processed FIFO

D - Flash File Stream
This is the one that will be used to stream a file from flash, this type can be interrupted only between each command execution.
This type will put in hold if any command is present in scripts queue and resumed when the scripts queue is empty.
This type is used with the command [ESP700]stream=/fs/mystream.gco
the file name must have the /fs/ prefix to be sure that the file is handled properly, the [ESP701] commands can handle it but only between commands commands execution, that the purpose of the stream= tag. This type will be added to the stream queue and processed FIFO.

E - Flash File script
This is the one that will be used to stream a file from flash, unlike previous type this type cannot be interrupted and will be excuted until the end. This one is used with the command [ESP700]/fs/myfile.gco
The file name must have the /fs/ prefix to be sure that the file is handled properly. The [ESP701] command do not handle it. The file should only contain few commands and it is used by macros only
This type will be added to the script queue and processed FIFO


F - SD File Stream
This is the one that will be used to stream a file from sd card, this type can be interrupted only between each command execution.
This type will put in hold if any command is present in scripts queue and resumed when the scripts queue is empty.
This type is used with the command [ESP700]stream=/sd/mystream.gco
the file name must have the /sd/ prefix to be sure that the file is handled properly, the [ESP701] commands can handle it but only between commands commands execution, that the purpose of the stream= tag. This type will be added to the stream queue and processed FIFO.

G - SD File script
This is the one that will be used to stream a file from sd card, unlike previous type this type cannot be interrupted and will be excuted until the end. This one is used with the command [ESP700]/sd/myfile.gco
The file name must have the /sd/ prefix to be sure that the file is handled properly. The [ESP701] command do not handle it. The file should only contain few commands and it is used by macros only
This type will be added to the script queue and processed FIFO

E- Invalid
The type is not yet identified, this type cannot be streamed and will raise an error.
</code></pre>
<p>2 - Streaming Queues
There are 3 types of queues for streams
A - Stream queue
This queue contain sd streams and fs streams, this queue has lower processing priority than script queue, which mean when the stream reach some state it can be interrupted, put in hold, and resumed.
The active stream of this queue can be monitored and controlled with the command [ESP701]
B - Script queue
This queue contains single commands, multiple commands, sd scripts and fs scripts. The queue has higher priority than script queue and will be processed before the stream queue. There is not control of this queue from user point of view.</p>
<pre><code>C - Emmergency Queue =&gt; TBC
This queue contain single commands that will be executed as soon as possible.
</code></pre>
<p>3 - Streaming queue states
The stream states only applied streams queue and only to the active stream, not to scripts queue.
A - idle
The streams queue is empty, but the scripts queue may not be empty
B - processing
It means at least one stream in streams queue is being processed, even in hold due to scripts queue not being empty.
C - paused
The current stream in stream queue is paused.
D - error
Currently not implemented because when a stream go to error it is removed from stream queue to process the next one in stream queue if any.</p>
<p>3 - Stream command states
The stream command states cover all states of a processed command.
A - Undefined
The state is undefined and the command will go to error state.
B - Start
This is the state to start a command or resume it. Next state is normally Ready to read cursor.</p>
<pre><code>C - Ready to read cursor
This is the state before really processing command, this is the state used to put a stream in hold to allow scripts queue or to respond to external change of state for stream like pause/abort. If not change state requested then the next state will be read cursor state
D - Read Cursor
This state read coming processing command from file/multiple commands line or single command.
According to the command the next state will be send gcode command state or send esp command state.
E - Send gcode command
Send gcode command to the output client, the command may have been completed with line number and checksum if is requested.
Depending of the command the next state will be wait for ack if an ack is requested or ready to read next command if no ack is requested.
F - Send esp command
The command has been identified as ESP command, so it will be handled internaly and response will be sent to the original client
The next state will be ready to read next command.

G - Wait for ack
If the command has been identified as GCode command and this command will send an ack, this state it to wait for it, if no ack received before a specific timout the next state will be the error state, if the ack is received before timeout then the next state will be ready to read next command.
H - Resend gcode command
In case of GCode command that is completed with line number and checksum and if there a checksum error received, this state will be resend the current gcode command again, ater a specific amount of failure the command will go to the error state.
I - Pause
This state will make the current stream queue on hold and process add a specific script to scripts queue if defined in settings, the next state will be paused.
J - Paused
This state will be waiting for resume or abort request to complete the stream.
K - Resume
If the current stream is paused it will resume it by adding a specific script to scripts queue if .defined in settings, and changing the next state as ready to read next command
L - Abort
This state will abort the current stream by adding a specific script to scripts queue if .defined in settings and changing the next state as end for the next command.
M - End
This state will close the current stream and remove it from the corresponding queue.
N - Error
If there is an error during the stream processing the error state will be raised, this state will  notify the user about the error and the next state will be end state to remove failing stream.
</code></pre>
<h2 id="operations">Operations</h2>
<p>the streaming is a loop of different operations
1 - Check external notifications / requests
This will check if there is an external request for change stream status e.g: pause or resume or abort</p>
<p>2 - Check what is the current active stream
This will check if there is a need of switching between queues and so switch between active streams, emmergency commands queue &gt; scripts queue &gt; streams queue</p>
<p>3 - Check what is the current active stream state
This will check if there is a need of changing the current state of the current active stream and applied it</p>
<p>4 - Check the client rx queue and process it
This will check if there is response  / command in the rx queue, parse the response if necessary to search for a command ack, add any external command to the stream queue coming, etc&hellip;</p>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          <article class="chapter">
<h1 id="webdav-api">WebDAV API</h1>
<p>The WebDAV server serve flash and sd at once.</p>
<h2 id="introduction">Introduction</h2>
<p>The protocol is based on HTTP and is designed to allow clients to perform remote Web content authoring operations.<br>
WebDav protocol provides facilities to copy, move, delete resources, to query and set properties on resources.<br>
This protocol has several features but many are useless for the purpose of this project, so the protocol will be followed but using only the features that are needed.</p>
<p>The authentication is not implemented yet.</p>
<p>If no namespace is supposed ok for xml tags because there is no possible conflict in webdav requests/responses, Windows seems request them so they have been added.</p>
<p>As it is embedded system on local network, the header <code>Date</code> is not supported, indeed it make no sense to give 1970 based year date, if system date is not initialized.</p>
<h2 id="webdav-version">WebDav version</h2>
<p>The version of WebDav that will be used is 1 because we do not need PROPATCH, LOCK and UNLOCK methods.
The DAV header will be set to 1.
The allow header will be set to GET, HEAD, PUT, DELETE, OPTIONS, PROPFIND, MKCOL, COPY, MOVE.</p>
<h2 id="time-format">Time format</h2>
<p>Date format for WebDav like last modified and creation date is the GMT time format with name of day and month in english: <code>Thu, 01 Jan 1970 00:04:34 GMT</code>, because even if the rfc says if can be in this format :<code>1997-12-01T17:42:21-08:00</code>, it seems not usable on Filezilla Pro neither Windows,  so english date is a must.</p>
<h2 id="get-method">GET method</h2>
<p>The GET method is used to retrieve information about the resource identified by the Request-URI. And the content of the resource is returned as the response body.
The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow</li>
<li>Last-Modified</li>
<li>Content-Length (if the resource is a file)</li>
<li>Content-Type (if the resource is a file)</li>
</ul>
<p>The content of the reponse is:</p>
<ul>
<li>the file if the resource is a file</li>
<li>empty if the resource is a directory</li>
</ul>
<p>The response code is:</p>
<ul>
<li>200 if the resource is a file or a directory and the request was successful</li>
<li>404 if the resource does not exist</li>
<li>500 if any error during the file streaming</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
</ul>
<h2 id="head-method">HEAD method</h2>
<p>The HEAD method is used to retrieve information about the resource identified by the Request-URI.
The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow</li>
<li>Last-Modified</li>
<li>Content-Length (if the resource is a file)</li>
<li>Content-Type (if the resource is a file)</li>
</ul>
<p>Unlike GET method, the HEAD method does not return the content of the resource.</p>
<p>The response code is:</p>
<ul>
<li>200 if the resource is a file or a directory and the request was successful</li>
<li>404 if the resource does not exist</li>
<li>500 if any error during the file streaming</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
</ul>
<h2 id="options-method">OPTIONS method</h2>
<p>The OPTIONS method is used to retrieve the communication options for WebDav.
The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow
No content
The response code is always 200.</li>
</ul>
<h2 id="delete-method">DELETE method</h2>
<p>The DELETE method is used to delete the resource identified by the Request-URI.
The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow
No content
The response code is:</li>
<li>204 if success</li>
<li>404 if the resource does not exist</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
<li>500 if any error during the file/dir deletion</li>
<li>400 if the resource is / or /sd or /fs</li>
</ul>
<h2 id="mkcol-method">MKCOL method</h2>
<p>The MKCOL method is used to create a new collection resource at the location specified by the Request-URI.
The request has the following headers:</p>
<ul>
<li>Destination is the path of the resource to create. to be used instead of the Request-URI if present.
The necessary headers in response are:</li>
<li>DAV</li>
<li>Allow
No content
The response code is:</li>
<li>201 if success</li>
<li>409 if the resource already exists</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
<li>500 if any error during the dir creation</li>
<li>400 if the resource is / or /sd or /fs</li>
</ul>
<h2 id="put-method">PUT method</h2>
<p>The PUT method is used to create a new non-collection resource at the location specified by the Request-URI.
The request has the following headers:</p>
<ul>
<li>Content-Length is the size  of the file.</li>
<li>Content-Type is the type of the file.</li>
</ul>
<p>no Overwrite header because we always overwrite the file.</p>
<p>the request content is the content of the resource to create.
The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow</li>
<li>Last-Modified
No content
The response code is:</li>
<li>201 if success and file is created</li>
<li>204 if success and file is overwritten</li>
<li>412 if the resource is a directory</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
<li>500 if any error during the file creation</li>
<li>507 if the file is too big for the targeted file system</li>
</ul>
<h2 id="propfind-method">PROPFIND method</h2>
<p>The PROPFIND method retrieves properties defined on the resource identified by the Request-URI, if the Request-URI is a collection it returns the properties of the collection and the properties of the members of the collection.
The request has the following headers:</p>
<ul>
<li>Depth can be 0 or 1 or infinity but we do not support infinity so instead we use 1 and that will be returned as the depth in the PROPFIND response</li>
<li>Content-Type is the type of the request body. It can be text/xml or application/xml or application/x-www-form-urlencoded or multipart/form-data but we only support text/xml.
this content can be ignored because we will always return the same content type.</li>
<li>Content-Length is the size of the request body.</li>
</ul>
<p>The request body can be ignored because we will always return the same content</p>
<p>The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow</li>
<li>Content-Type is text/xml</li>
<li>Connection: close</li>
<li>Content-Length is the size of the response body but because it is not possible to know the size of the response body before generating it because we do not know the number of resources in the directory, we will use chunked transfer encoding. so this header will not be present in the response.</li>
<li>depth=1 will only be added in case of a request of depth=infinity</li>
</ul>
<p>The response body is an xml document containing the properties of the resource.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;D:multistatus</span> <span style="color:#a6e22e">xmlns:D=</span><span style="color:#e6db74">&#34;DAV:&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;D:response</span> <span style="color:#a6e22e">xmlns:esp3d=</span><span style="color:#e6db74">&#34;DAV:&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;D:href&gt;</span>/webdav<span style="color:#f92672">&lt;/D:href&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;D:propstat&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;D:status&gt;</span>HTTP/1.1 200 OK<span style="color:#f92672">&lt;/D:status&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;D:prop&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:getlastmodified&gt;</span>Wed, 25 Oct 2023 04:44:55 GMT<span style="color:#f92672">&lt;/esp3d:getlastmodified&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:creationdate&gt;</span>Wed, 25 Oct 2023 04:44:55 GMT<span style="color:#f92672">&lt;/esp3d:creationdate&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;D:resourcetype&gt;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">&lt;D:collection/&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/D:resourcetype&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:displayname&gt;</span>/<span style="color:#f92672">&lt;/esp3d:displayname&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;/D:prop&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/D:propstat&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/D:response&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;D:response</span> <span style="color:#a6e22e">xmlns:esp3d=</span><span style="color:#e6db74">&#34;DAV:&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;D:href&gt;</span>/webdav/fs<span style="color:#f92672">&lt;/D:href&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;D:propstat&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;D:status&gt;</span>HTTP/1.1 200 OK<span style="color:#f92672">&lt;/D:status&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;D:prop&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:getlastmodified&gt;</span>Wed, 31 Dec 1969 23:59:59 GMT<span style="color:#f92672">&lt;/esp3d:getlastmodified&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:creationdate&gt;</span>Thu, 01 Jan 1970 00:00:00 GMT<span style="color:#f92672">&lt;/esp3d:creationdate&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;D:resourcetype&gt;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">&lt;D:collection/&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/D:resourcetype&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:displayname&gt;</span>fs<span style="color:#f92672">&lt;/esp3d:displayname&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;/D:prop&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/D:propstat&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/D:response&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;D:response</span> <span style="color:#a6e22e">xmlns:esp3d=</span><span style="color:#e6db74">&#34;DAV:&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;D:href&gt;</span>/webdav/sd<span style="color:#f92672">&lt;/D:href&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;D:propstat&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;D:status&gt;</span>HTTP/1.1 200 OK<span style="color:#f92672">&lt;/D:status&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;D:prop&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:getlastmodified&gt;</span>Thu, 01 Jan 1970 00:00:00 GMT<span style="color:#f92672">&lt;/esp3d:getlastmodified&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:creationdate&gt;</span>Thu, 01 Jan 1970 00:00:00 GMT<span style="color:#f92672">&lt;/esp3d:creationdate&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;D:resourcetype&gt;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">&lt;D:collection/&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/D:resourcetype&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;esp3d:displayname&gt;</span>sd<span style="color:#f92672">&lt;/esp3d:displayname&gt;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">&lt;/D:prop&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/D:propstat&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/D:response&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/D:multistatus&gt;</span></span></span></code></pre></div><p>The response code is:</p>
<ul>
<li>207 if success</li>
<li>404 if the resource does not exist</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
</ul>
<h2 id="copy-method">COPY method</h2>
<p>The COPY method is used to copy the resource identified by the Request-URI to the destination URI.
The copy is allowed only for a file and not for a directory.
Only move /fs to /fs and /sd to /sd</p>
<p>The request has the following headers:</p>
<ul>
<li>Destination is the path of the resource to create. to be used instead of the Request-URI if present.</li>
<li>Overwrite is a boolean that indicates if the destination resource should be overwritten if it already exists. If the header is not present, the default value is false.</li>
<li>Depth can be 0 or 1 or infinity but we do not support collection copy so this header is ignored</li>
</ul>
<p>The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow</li>
</ul>
<p>No content</p>
<p>The response code is:</p>
<ul>
<li>201 if success and file is created</li>
<li>204 if success and file is overwritten</li>
<li>404 if the resource does not exist</li>
<li>413 if the resource is a directory</li>
<li>412 if the destination resource already exists and overwrite is false</li>
<li>409 if overwrite is true and the destination and source are different types (file or directory)</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
<li>500 if any error during the file creation</li>
<li>507 if the file is too big for the targeted file system</li>
<li>400 if source or destination is / or /sd or /fs, or try to /sd to /fs or /fs to /sd</li>
</ul>
<h2 id="move-method">MOVE method</h2>
<p>The MOVE method is used to move the resource identified by the Request-URI to the destination URI.
There is no merge of the destination resource and the source resource but the destination resource is overwritten/replaced if it already exists.
Only move /fs to /fs and /sd to /sd</p>
<p>The request has the following headers:</p>
<ul>
<li>Destination is the path of the resource to create. to be used instead of the Request-URI if present.</li>
<li>Overwrite is a boolean that indicates if the destination resource should be overwritten if it already exists. If the header is not present, the default value is false.</li>
</ul>
<p>The necessary headers in response are:</p>
<ul>
<li>DAV</li>
<li>Allow</li>
</ul>
<p>No content</p>
<p>The response code is:</p>
<ul>
<li>201 if success and file is created</li>
<li>204 if success and file is overwritten</li>
<li>404 if the resource does not exist</li>
<li>412 if the destination resource already exists and overwrite is false</li>
<li>409 if overwrite is true and the destination and source are different types (file or directory)</li>
<li>503 if any error accessing the local file system (e.g. access denied)</li>
<li>500 if any error during the file creation</li>
<li>400 if source or destination is / or /sd or /fs, or try to move /sd to /fs or /fs to /sd</li>
</ul>

            <footer class="footline">

<hr>
<center>If any error or need any addition,<br> please let me know by opening a ticket <a href="https://github.com/luc-github/esp3d.io/issues" target="_blank">here</a><br> or submit a fix by <a href="https://github.com/luc-github/esp3d.io/pulls" target="_blank">PR</a> or use the edit button on top menu</center>

            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="/js/clipboard.min.js?1722688348" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-color.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-drag.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-ease.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-selection.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-timer.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-transition.min.js?1722688348" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1722688348" defer></script>
    <script src="/js/js-yaml.min.js?1722688348" defer></script>
    <script src="/js/mermaid.min.js?1722688348" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{ \"theme\": \"dark\" }");
    </script>
    <script src="/js/theme.js?1722688348" defer></script>
  </body>
</html>
